<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrera de Verbos - Escribe el Pasado</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            width: 100%;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 100;
        }

        h1 {
            color: #5a67d8;
            font-size: 1.8em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .subtitle {
            color: #4a5568;
            font-size: 0.9em;
            margin-top: 5px;
            font-weight: 600;
        }

        .game-wrapper {
            position: relative;
            width: 95%;
            max-width: 900px;
            margin: 20px auto;
        }

        .game-container {
            position: relative;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            border: 4px solid #5a67d8;
        }

        #gameCanvas {
            width: 100%;
            height: 350px;
            display: block;
            background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 50%, #90EE90 50%, #7CFC00 100%);
        }

        /* HUD Superior */
        .hud {
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            pointer-events: none;
            z-index: 10;
        }

        .verb-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 30px;
            border-radius: 15px;
            border: 3px solid #5a67d8;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-align: center;
        }

        .verb-label {
            font-size: 0.8em;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .verb-text {
            font-size: 2.5em;
            font-weight: bold;
            color: #2d3748;
            text-transform: uppercase;
            letter-spacing: 2px;
            min-width: 180px;
        }

        .stats-panel {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: flex-end;
        }

        .stat-badge {
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid #e2e8f0;
            font-weight: bold;
            color: #2d3748;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .hearts {
            color: #e53e3e;
            font-size: 1.3em;
            letter-spacing: 2px;
        }

        .progress-container {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 20px;
            background: rgba(255,255,255,0.5);
            border-radius: 10px;
            border: 2px solid white;
            overflow: hidden;
            z-index: 10;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 10px;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.75em;
            font-weight: bold;
            color: #2d3748;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }

        /* Feedback visual */
        .feedback-overlay {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: bold;
            opacity: 0;
            pointer-events: none;
            z-index: 60;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }

        .feedback-overlay.show {
            animation: feedbackPop 0.6s ease-out;
        }

        @keyframes feedbackPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        .feedback-overlay.correct {
            color: #48bb78;
        }

        .feedback-overlay.wrong {
            color: #e53e3e;
        }

        /* Controles - Input Area */
        .controls-area {
            background: #f7fafc;
            padding: 25px;
            border-top: 3px solid #e2e8f0;
            text-align: center;
        }

        .input-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            max-width: 500px;
            margin: 0 auto;
        }

        .input-field {
            flex: 1;
            min-width: 200px;
            padding: 15px 20px;
            font-size: 1.3em;
            border: 3px solid #cbd5e0;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            color: #2d3748;
            text-transform: lowercase;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #5a67d8;
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.2);
        }

        .input-field.correct {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .input-field.wrong {
            border-color: #e53e3e;
            background: #fff5f5;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .btn-check {
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 0 #4c51bf;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn-check:hover:not(:disabled) {
            background: #4c51bf;
            transform: translateY(-2px);
        }

        .btn-check:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #4c51bf;
        }

        .btn-check:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .hint-text {
            margin-top: 12px;
            color: #718096;
            font-size: 0.9em;
            font-style: italic;
        }

        .rules-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
            font-size: 0.85em;
        }

        .rule-item {
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid #e2e8f0;
            color: #4a5568;
        }

        .rule-item strong {
            color: #5a67d8;
        }

        /* Modales */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .modal-content h2 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .modal-content p {
            color: #4a5568;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .btn-modal {
            padding: 12px 35px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            background: #5a67d8;
            color: white;
        }

        @media (max-width: 600px) {
            .verb-text {
                font-size: 2em;
            }
            
            .input-field {
                font-size: 1.1em;
                width: 100%;
            }
            
            .btn-check {
                width: 100%;
            }
            
            .input-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üèÉ‚Äç‚ôÇÔ∏è Carrera de Verbos Regulares</h1>
        <div class="subtitle">Escribe la forma en pasado (-ed) para correr hacia la meta</div>
    </header>

    <div class="game-wrapper">
        <div class="game-container">
            <canvas id="gameCanvas"></canvas>
            
            <!-- HUD Superior -->
            <div class="hud">
                <div class="verb-box">
                    <div class="verb-label">Escribe el pasado de:</div>
                    <div class="verb-text" id="verbDisplay">PLAY</div>
                </div>
                
                <div class="stats-panel">
                    <div class="stat-badge">Score: <span id="scoreDisplay">0</span></div>
                    <div class="stat-badge hearts" id="heartsDisplay">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                    <div class="stat-badge">Meta: <span id="distanceDisplay">0</span>%</div>
                </div>
            </div>

            <!-- Barra de progreso -->
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-text" id="progressText">0m / 100m</div>
            </div>

            <!-- Feedback visual -->
            <div class="feedback-overlay" id="feedback"></div>
        </div>

        <!-- Controles: Input de texto -->
        <div class="controls-area">
            <div class="input-group">
                <input type="text" 
                       class="input-field" 
                       id="answerInput" 
                       placeholder="Ej: played" 
                       autocomplete="off"
                       disabled>
                <button class="btn-check" id="btnCheck" onclick="checkAnswer()" disabled>
                    ‚úì Verificar
                </button>
            </div>
            <div class="hint-text" id="hintText">
                Escribe el verbo en pasado (ej: play ‚Üí played)
            </div>
            <div class="rules-bar">
                <div class="rule-item"><strong>Normal:</strong> +ed</div>
                <div class="rule-item"><strong>-e:</strong> +d</div>
                <div class="rule-item"><strong>C+y:</strong> -y+ied</div>
                <div class="rule-item"><strong>CVC:</strong> doble consonante</div>
            </div>
        </div>
    </div>

    <!-- Pantalla de inicio -->
    <div class="modal-overlay active" id="startModal">
        <div class="modal-content">
            <div class="modal-icon">üèÅ</div>
            <h2>Carrera de Pasado Simple</h2>
            <p style="font-size:1.1em; margin-bottom:20px;">
                Te mostrar√© un verbo en <strong>infinitivo</strong> (base).<br>
                Debes escribir correctamente su forma en <strong>pasado (-ed)</strong>.
            </p>
            <div style="background:#f7fafc; padding:20px; border-radius:10px; text-align:left; margin:20px 0;">
                <p style="margin-bottom:10px;"><strong>Ejemplos:</strong></p>
                <p>‚Ä¢ play ‚Üí <strong>played</strong></p>
                <p>‚Ä¢ dance ‚Üí <strong>danced</strong> (termina en e: solo +d)</p>
                <p>‚Ä¢ study ‚Üí <strong>studied</strong> (consonante+y: y‚Üíi+ed)</p>
                <p>‚Ä¢ stop ‚Üí <strong>stopped</strong> (CVC: doble consonante)</p>
            </div>
            <p>Cada acierto te hace avanzar 10 metros.<br>¬°Necesitas 100m para ganar!</p>
            <button class="btn-modal" onclick="startGame()">¬°COMENZAR!</button>
        </div>
    </div>

    <!-- Pantalla de fin -->
    <div class="modal-overlay" id="endModal">
        <div class="modal-content">
            <div class="modal-icon" id="endIcon">üèÜ</div>
            <h2 id="endTitle">¬°Victoria!</h2>
            <p id="endMessage">Has llegado a la meta</p>
            <div style="font-size:2em; font-weight:bold; color:#5a67d8; margin:15px 0;">
                <span id="finalScore">0</span> pts
            </div>
            <button class="btn-modal" onclick="resetGame()">Jugar de Nuevo</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Resize canvas
        function resize() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        // Game State
        let game = {
            active: false,
            score: 0,
            lives: 3,
            distance: 0,
            currentVerb: null,
            runner: { x: 50, y: 0, targetX: 50, frame: 0 },
            clouds: [],
            particles: []
        };

        // Database: Solo verbos regulares con sus formas correctas
        const verbs = [
            // Normales (+ed)
            { base: "play", past: "played", type: "normal" },
            { base: "walk", past: "walked", type: "normal" },
            { base: "watch", past: "watched", type: "normal" },
            { base: "clean", past: "cleaned", type: "normal" },
            { base: "cook", past: "cooked", type: "normal" },
            { base: "work", past: "worked", type: "normal" },
            { base: "wash", past: "washed", type: "normal" },
            { base: "paint", past: "painted", type: "normal" },
            { base: "surf", past: "surfed", type: "normal" },
            { base: "climb", past: "climbed", type: "normal" },
            { base: "jump", past: "jumped", type: "normal" },
            { base: "watch", past: "watched", type: "normal" },
            { base: "listen", past: "listened", type: "normal" },
            { base: "open", past: "opened", type: "normal" },
            { base: "close", past: "closed", type: "normal" },
            { base: "want", past: "wanted", type: "normal" },
            { base: "need", past: "needed", type: "normal" },
            { base: "help", past: "helped", type: "normal" },
            { base: "call", past: "called", type: "normal" },
            { base: "ask", past: "asked", type: "normal" },
            
            // Terminan en e (+d)
            { base: "dance", past: "danced", type: "e-final" },
            { base: "like", past: "liked", type: "e-final" },
            { base: "love", past: "loved", type: "e-final" },
            { base: "live", past: "lived", type: "e-final" },
            { base: "use", past: "used", type: "e-final" },
            { base: "phone", past: "phoned", type: "e-final" },
            { base: "arrive", past: "arrived", type: "e-final" },
            { base: "agree", past: "agreed", type: "e-final" },
            { base: "hate", past: "hated", type: "e-final" },
            { base: "skate", past: "skated", type: "e-final" },
            
            // Consonante + y (-y+ied)
            { base: "study", past: "studied", type: "y" },
            { base: "carry", past: "carried", type: "y" },
            { base: "cry", past: "cried", type: "y" },
            { base: "try", past: "tried", type: "y" },
            { base: "dry", past: "dried", type: "y" },
            { base: "fly", past: "flied", type: "y" },
            { base: "worry", past: "worried", type: "y" },
            { base: "hurry", past: "hurried", type: "y" },
            { base: "marry", past: "married", type: "y" },
            { base: "copy", past: "copied", type: "y" },
            
            // CVC doble consonante
            { base: "stop", past: "stopped", type: "cvc" },
            { base: "plan", past: "planned", type: "cvc" },
            { base: "shop", past: "shopped", type: "cvc" },
            { base: "drop", past: "dropped", type: "cvc" },
            { base: "rob", past: "robbed", type: "cvc" },
            { base: "grab", past: "grabbed", type: "cvc" },
            { base: "pat", past: "patted", type: "cvc" },
            { base: "nod", past: "nodded", type: "cvc" },
            { base: "beg", past: "begged", type: "cvc" },
            { base: "prefer", past: "preferred", type: "cvc" }
        ];

        let availableVerbs = [];
        let usedVerbs = [];

        function initClouds() {
            game.clouds = [];
            for (let i = 0; i < 6; i++) {
                game.clouds.push({
                    x: Math.random() * canvas.width,
                    y: 20 + Math.random() * 60,
                    speed: 0.3 + Math.random() * 0.4,
                    size: 25 + Math.random() * 15
                });
            }
        }

        function spawnParticles(x, y, color) {
            for (let i = 0; i < 20; i++) {
                game.particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 15,
                    vy: -Math.random() * 10 - 3,
                    life: 50,
                    color: color,
                    size: 5 + Math.random() * 5
                });
            }
        }

        function update() {
            game.clouds.forEach(cloud => {
                cloud.x -= cloud.speed;
                if (cloud.x < -100) cloud.x = canvas.width + 50;
            });

            game.particles = game.particles.filter(p => p.life > 0);
            game.particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.3;
                p.life--;
            });

            if (Math.abs(game.runner.targetX - game.runner.x) > 1) {
                game.runner.x += (game.runner.targetX - game.runner.x) * 0.08;
                game.runner.frame += 0.3;
            } else {
                game.runner.frame = 0;
            }
        }

        function drawRunner() {
            const x = game.runner.x;
            const y = canvas.height - 120;
            const legSwing = Math.sin(game.runner.frame) * 15;
            
            ctx.save();
            
            // Shadow
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.ellipse(x + 20, y + 50, 18, 4, 0, 0, Math.PI * 2);
            ctx.fill();
            
            let bodyColor = '#5a67d8';
            if (game.lives === 2) bodyColor = '#ed8936';
            if (game.lives === 1) bodyColor = '#e53e3e';
            
            // Legs
            ctx.strokeStyle = '#2d3748';
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            
            ctx.beginPath();
            ctx.moveTo(x + 20, y + 30);
            ctx.lineTo(x + 20 - legSwing, y + 48);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(x + 20, y + 30);
            ctx.lineTo(x + 20 + legSwing, y + 48);
            ctx.stroke();
            
            // Body
            ctx.fillStyle = bodyColor;
            ctx.fillRect(x + 10, y + 10, 20, 25);
            
            // Head
            ctx.fillStyle = '#fbd38d';
            ctx.beginPath();
            ctx.arc(x + 20, y + 5, 12, 0, Math.PI * 2);
            ctx.fill();
            
            // Eyes
            ctx.fillStyle = '#2d3748';
            ctx.beginPath();
            ctx.arc(x + 24, y + 2, 2.5, 0, Math.PI * 2);
            ctx.fill();
            
            // Arms
            ctx.strokeStyle = '#fbd38d';
            ctx.lineWidth = 4;
            const armSwing = Math.cos(game.runner.frame) * 12;
            
            ctx.beginPath();
            ctx.moveTo(x + 15, y + 15);
            ctx.lineTo(x + 5 + armSwing, y + 25);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(x + 25, y + 15);
            ctx.lineTo(x + 35 - armSwing, y + 25);
            ctx.stroke();
            
            ctx.restore();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const groundY = canvas.height - 70;
            ctx.fillStyle = '#7CFC00';
            ctx.fillRect(0, groundY, canvas.width, 70);
            
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.setLineDash([20, 15]);
            ctx.beginPath();
            ctx.moveTo(0, groundY + 35);
            ctx.lineTo(canvas.width, groundY + 35);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            game.clouds.forEach(cloud => {
                ctx.beginPath();
                ctx.arc(cloud.x, cloud.y, cloud.size, 0, Math.PI * 2);
                ctx.arc(cloud.x + cloud.size * 0.7, cloud.y, cloud.size * 0.8, 0, Math.PI * 2);
                ctx.arc(cloud.x + cloud.size * 1.4, cloud.y, cloud.size * 0.6, 0, Math.PI * 2);
                ctx.fill();
            });
            
            ctx.fillStyle = '#2d3748';
            ctx.font = 'bold 12px Arial';
            for (let i = 0; i <= 100; i += 20) {
                const markX = 50 + (i / 100) * (canvas.width - 150);
                ctx.fillRect(markX, groundY, 2, 15);
                ctx.fillText(i + 'm', markX - 10, groundY + 30);
            }
            
            const finishX = canvas.width - 80;
            ctx.fillStyle = '#e53e3e';
            ctx.fillRect(finishX, groundY - 80, 5, 80);
            
            const squareSize = 10;
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    ctx.fillStyle = (row + col) % 2 === 0 ? '#fff' : '#2d3748';
                    ctx.fillRect(finishX + 5 + (col * squareSize), groundY - 80 + (row * squareSize), squareSize, squareSize);
                }
            }
            
            ctx.save();
            ctx.translate(finishX, groundY - 90);
            ctx.rotate(-Math.PI / 12);
            ctx.fillStyle = '#e53e3e';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('META', 0, 0);
            ctx.restore();
            
            game.particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / 50;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            });
            ctx.globalAlpha = 1;
            
            drawRunner();
        }

        function loop() {
            if (game.active) {
                update();
                draw();
            }
            requestAnimationFrame(loop);
        }

        function nextVerb() {
            if (availableVerbs.length === 0) {
                availableVerbs = [...verbs].sort(() => Math.random() - 0.5);
            }
            
            game.currentVerb = availableVerbs.pop();
            usedVerbs.push(game.currentVerb);
            
            document.getElementById('verbDisplay').textContent = game.currentVerb.base.toUpperCase();
            
            const input = document.getElementById('answerInput');
            input.value = '';
            input.disabled = false;
            input.focus();
            input.className = 'input-field';
            
            document.getElementById('btnCheck').disabled = false;
            
            // Hint seg√∫n tipo
            let hint = '';
            switch(game.currentVerb.type) {
                case 'normal': hint = 'A√±ade -ed'; break;
                case 'e-final': hint = 'Termina en e: a√±ade -d'; break;
                case 'y': hint = 'Consonante + y: cambia y‚Üíi + ed'; break;
                case 'cvc': hint = 'CVC: dobla la √∫ltima consonante'; break;
            }
            document.getElementById('hintText').innerHTML = `<span style="color:#5a67d8">üí° Regla:</span> ${hint}`;
        }

        function checkAnswer() {
            if (!game.active) return;
            
            const input = document.getElementById('answerInput');
            const userAnswer = input.value.trim().toLowerCase();
            const correctAnswer = game.currentVerb.past.toLowerCase();
            const feedback = document.getElementById('feedback');
            
            if (!userAnswer) return;
            
            document.getElementById('btnCheck').disabled = true;
            input.disabled = true;
            
            if (userAnswer === correctAnswer) {
                // Correct!
                game.score += 10;
                game.distance += 10; // 10 aciertos = 100m
                
                const maxX = canvas.width - 120;
                const startX = 50;
                game.runner.targetX = startX + (game.distance / 100) * (maxX - startX);
                
                feedback.textContent = '‚úÖ';
                feedback.className = 'feedback-overlay show correct';
                input.className = 'input-field correct';
                spawnParticles(game.runner.x + 20, canvas.height - 150, '#48bb78');
                
                updateUI();
                
                if (game.distance >= 100) {
                    setTimeout(winGame, 1000);
                } else {
                    setTimeout(() => {
                        feedback.classList.remove('show');
                        nextVerb();
                    }, 1000);
                }
            } else {
                // Wrong!
                game.lives--;
                updateUI();
                
                feedback.textContent = '‚ùå';
                feedback.className = 'feedback-overlay show wrong';
                input.className = 'input-field wrong';
                input.value = correctAnswer;
                input.style.textDecoration = 'line-through';
                
                spawnParticles(game.runner.x + 20, canvas.height - 150, '#e53e3e');
                
                canvas.style.filter = 'brightness(0.7) sepia(1) hue-rotate(-50deg) saturate(5)';
                setTimeout(() => canvas.style.filter = 'none', 300);
                
                if (game.lives <= 0) {
                    setTimeout(gameOver, 1500);
                } else {
                    setTimeout(() => {
                        feedback.classList.remove('show');
                        input.style.textDecoration = 'none';
                        input.className = 'input-field';
                        nextVerb();
                    }, 1500);
                }
            }
        }

        function updateUI() {
            document.getElementById('scoreDisplay').textContent = game.score;
            document.getElementById('distanceDisplay').textContent = Math.floor(game.distance);
            document.getElementById('progressBar').style.width = game.distance + '%';
            document.getElementById('progressText').textContent = `${Math.floor(game.distance)}m / 100m`;
            
            let hearts = '';
            for (let i = 0; i < game.lives; i++) hearts += '‚ù§Ô∏è';
            for (let i = game.lives; i < 3; i++) hearts += 'üñ§';
            document.getElementById('heartsDisplay').textContent = hearts;
        }

        function startGame() {
            document.getElementById('startModal').classList.remove('active');
            
            game.active = true;
            game.score = 0;
            game.lives = 3;
            game.distance = 0;
            game.runner.x = 50;
            game.runner.targetX = 50;
            game.runner.frame = 0;
            usedVerbs = [];
            
            availableVerbs = [...verbs].sort(() => Math.random() - 0.5);
            
            initClouds();
            updateUI();
            nextVerb();
        }

        function winGame() {
            game.active = false;
            document.getElementById('endIcon').textContent = 'üèÜ';
            document.getElementById('endTitle').textContent = '¬°META ALCANZADA!';
            document.getElementById('endMessage').textContent = '¬°Dominas el pasado simple regular!';
            document.getElementById('finalScore').textContent = game.score;
            document.getElementById('endModal').classList.add('active');
        }

        function gameOver() {
            game.active = false;
            document.getElementById('endIcon').textContent = 'üíî';
            document.getElementById('endTitle').textContent = 'GAME OVER';
            document.getElementById('endMessage').textContent = `Llegaste a ${Math.floor(game.distance)}m. ¬°Int√©ntalo de nuevo!`;
            document.getElementById('finalScore').textContent = game.score;
            document.getElementById('endModal').classList.add('active');
        }

        function resetGame() {
            document.getElementById('endModal').classList.remove('active');
            document.getElementById('startModal').classList.add('active');
            
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').disabled = true;
            document.getElementById('btnCheck').disabled = true;
            game.distance = 0;
            game.runner.x = 50;
            game.runner.targetX = 50;
            draw();
        }

        // Enter key support
        document.getElementById('answerInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('btnCheck').disabled) {
                checkAnswer();
            }
        });

        // Initialize
        initClouds();
        loop();
    </script>
</body>
</html>