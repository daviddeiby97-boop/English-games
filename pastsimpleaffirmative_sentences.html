<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentence Master - Past Simple Regular Verbs</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Nunito:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #d97706;
            --primary-dark: #b45309;
            --secondary: #f59e0b;
            --accent: #fbbf24;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --dark: #451a03;
            --light: #fffbeb;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #78350f 0%, #d97706 50%, #f59e0b 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.3;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            max-width: 900px;
            width: 90%;
            position: relative;
            z-index: 10;
            border: 2px solid rgba(251, 191, 36, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-family: 'Fredoka', sans-serif;
            font-size: 3rem;
            background: linear-gradient(135deg, var(--primary), var(--dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            color: #78350f;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .mode-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-weight: 700;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 4px 6px -1px rgba(217, 119, 6, 0.5);
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--dark), #78350f);
            padding: 1rem 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            color: #fffbeb;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Fredoka', sans-serif;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .game-area {
            background: #fffbeb;
            border-radius: 20px;
            padding: 2rem;
            min-height: 300px;
            position: relative;
            overflow: hidden;
            border: 3px solid #fcd34d;
        }

        .past-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 1rem;
            letter-spacing: 0.05em;
            background: #fef3c7;
            color: #92400e;
            border: 2px solid #fbbf24;
        }

        .instruction {
            text-align: center;
            color: #78350f;
            margin-bottom: 2rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .grammar-tip {
            background: #fef3c7;
            border-left: 4px solid var(--primary);
            padding: 1rem;
            border-radius: 0 10px 10px 0;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            color: #78350f;
            line-height: 1.6;
        }

        .words-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
            min-height: 60px;
            padding: 1rem;
            background: white;
            border-radius: 15px;
            border: 2px dashed #fbbf24;
            transition: all 0.3s ease;
        }

        .words-container.drag-over {
            background: #fef3c7;
            border-color: var(--primary);
            transform: scale(1.02);
        }

        .word {
            background: linear-gradient(135deg, #ffffff, #fffbeb);
            border: 2px solid #fcd34d;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            cursor: move;
            font-weight: 700;
            font-size: 1.1rem;
            color: #451a03;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        .word::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .word:hover {
            transform: translateY(-2px) rotate(2deg);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
            background: linear-gradient(135deg, #fef3c7, #fde68a);
        }

        .word:hover::before {
            left: 100%;
        }

        .word.dragging {
            opacity: 0.5;
            transform: scale(1.1);
            cursor: grabbing;
        }

        .word.placed {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            border-color: transparent;
            animation: placeWord 0.5s ease;
        }

        @keyframes placeWord {
            0% { transform: scale(1.2); }
            50% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        .answer-area {
            background: white;
            border: 3px solid #fbbf24;
            border-radius: 15px;
            padding: 2rem;
            min-height: 100px;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .answer-area.correct {
            border-color: var(--success);
            background: #ecfdf5;
            animation: correctPulse 0.6s ease;
        }

        .answer-area.wrong {
            border-color: var(--error);
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .drop-zone-placeholder {
            color: #d97706;
            font-style: italic;
            pointer-events: none;
            opacity: 0.7;
        }

        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        button {
            font-family: 'Nunito', sans-serif;
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 6px -1px rgba(217, 119, 6, 0.5);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(217, 119, 6, 0.5);
        }

        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 2px solid #fcd34d;
        }

        .btn-secondary:hover {
            background: #fffbeb;
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.5);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(16, 185, 129, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #fef3c7;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 2rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .hint-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            border-radius: 0 10px 10px 0;
            margin-top: 1rem;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .hint-box.show {
            display: block;
        }

        .timer {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #fbbf24;
        }

        .timer.warning {
            color: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (max-width: 640px) {
            h1 { font-size: 2rem; }
            .game-container { padding: 1.5rem; }
            .word { padding: 0.5rem 1rem; font-size: 1rem; }
            .stats-bar { flex-direction: column; gap: 1rem; }
        }

        .floating-icon {
            position: absolute;
            opacity: 0.1;
            font-size: 4rem;
            animation: float 6s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="floating-icon" style="top: 10%; left: 10%;">üìú</div>
        <div class="floating-icon" style="bottom: 10%; right: 10%; animation-delay: -2s;">‚è∞</div>
        
        <header class="header">
            <h1>üìú Past Master</h1>
            <p class="subtitle">Ordena las oraciones en pasado</p>
            <span class="mode-badge">Modo: Past Simple Afirmativo</span>
        </header>

        <div class="stats-bar">
            <div class="stat">
                <span class="stat-value" id="level">1</span>
                <span class="stat-label">Nivel</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="score">0</span>
                <span class="stat-label">Puntos</span>
            </div>
            <div class="timer" id="timer">00:00</div>
        </div>

        <div class="game-area">
            <span class="past-badge">üìÖ Oraci√≥n Pasada</span>
            
            <div class="grammar-tip">
                <strong>Reglas del Past Simple (verbos regulares):</strong><br>
                ‚Ä¢ Verbo + <strong>ed</strong> (play ‚Üí played)<br>
                ‚Ä¢ Verbo terminado en <strong>e</strong> + <strong>d</strong> (live ‚Üí lived)<br>
                ‚Ä¢ Consonante + <strong>y</strong> ‚Üí <strong>ied</strong> (study ‚Üí studied)<br>
                ‚Ä¢ Vocal + <strong>y</strong> ‚Üí <strong>yed</strong> (play ‚Üí played)
            </div>

            <p class="instruction" id="instruction">
                Arrastra las palabras para formar la oraci√≥n en pasado correcta
            </p>

            <div class="answer-area" id="answer-area">
                <span class="drop-zone-placeholder">Arrastra las palabras aqu√≠...</span>
            </div>

            <div class="words-container" id="words-container">
                <!-- Las palabras se generar√°n aqu√≠ -->
            </div>

            <div class="hint-box" id="hint-box">
                üí° <strong>Traducci√≥n:</strong> <span id="hint-text"></span>
            </div>
        </div>

        <div class="controls">
            <button class="btn-secondary" onclick="game.showHint()">
                üí° Pista (-5 pts)
            </button>
            <button class="btn-secondary" onclick="game.resetLevel()">
                üîÑ Reintentar
            </button>
            <button class="btn-success" onclick="game.checkAnswer()">
                ‚úì Verificar
            </button>
            <button class="btn-primary" onclick="game.nextLevel()" id="next-btn" style="display: none;">
                Siguiente ‚ûú
            </button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
    </div>

    <script>
        class PastSimpleGame {
            constructor() {
                this.levels = [
                    {
                        words: ['I', 'worked', 'in', 'the', 'garden', 'yesterday'],
                        hint: 'Yo trabaj√© en el jard√≠n ayer',
                        rule: 'work + ed'
                    },
                    {
                        words: ['She', 'played', 'tennis', 'last', 'Saturday'],
                        hint: 'Ella jug√≥ al tenis el s√°bado pasado',
                        rule: 'play + ed'
                    },
                    {
                        words: ['They', 'studied', 'for', 'the', 'exam', 'all', 'night'],
                        hint: 'Ellos estudiaron para el examen toda la noche',
                        rule: 'study ‚Üí ied (consonante + y)'
                    },
                    {
                        words: ['He', 'watched', 'a', 'movie', 'last', 'night'],
                        hint: '√âl vio una pel√≠cula anoche',
                        rule: 'watch + ed'
                    },
                    {
                        words: ['We', 'walked', 'to', 'the', 'park', 'yesterday'],
                        hint: 'Nosotros caminamos al parque ayer',
                        rule: 'walk + ed'
                    },
                    {
                        words: ['My', 'mother', 'talked', 'to', 'the', 'teacher', 'this', 'morning'],
                        hint: 'Mi madre habl√≥ con el profesor esta ma√±ana',
                        rule: 'talk + ed'
                    },
                    {
                        words: ['The', 'children', 'looked', 'at', 'the', 'pictures', 'carefully'],
                        hint: 'Los ni√±os miraron las fotos cuidadosamente',
                        rule: 'look + ed'
                    },
                    {
                        words: ['She', 'listened', 'to', 'music', 'on', 'the', 'way', 'home'],
                        hint: 'Ella escuch√≥ m√∫sica en el camino a casa',
                        rule: 'listen + ed'
                    },
                    {
                        words: ['My', 'grandmother', 'cooked', 'a', 'delicious', 'meal'],
                        hint: 'Mi abuela cocin√≥ una comida deliciosa',
                        rule: 'cook + ed'
                    },
                    {
                        words: ['He', 'cleaned', 'his', 'room', 'before', 'lunch'],
                        hint: '√âl limpi√≥ su cuarto antes del almuerzo',
                        rule: 'clean + ed'
                    },
                    {
                        words: ['She', 'washed', 'her', 'car', 'last', 'weekend'],
                        hint: 'Ella lav√≥ su coche el fin de semana pasado',
                        rule: 'wash + ed'
                    },
                    {
                        words: ['We', 'danced', 'at', 'the', 'party', 'until', 'midnight'],
                        hint: 'Nosotros bailamos en la fiesta hasta medianoche',
                        rule: 'dance + d (termina en e)'
                    },
                    {
                        words: ['The', 'train', 'arrived', 'on', 'time', 'yesterday'],
                        hint: 'El tren lleg√≥ a tiempo ayer',
                        rule: 'arrive + d (termina en e)'
                    },
                    {
                        words: ['They', 'lived', 'in', 'Paris', 'for', 'two', 'years'],
                        hint: 'Ellos vivieron en Par√≠s por dos a√±os',
                        rule: 'live + d (termina en e)'
                    },
                    {
                        words: ['I', 'loved', 'that', 'book', 'when', 'I', 'was', 'young'],
                        hint: 'Yo am√© ese libro cuando era joven',
                        rule: 'love + d (termina en e)'
                    },
                    {
                        words: ['She', 'liked', 'the', 'gift', 'very', 'much'],
                        hint: 'A ella le gust√≥ mucho el regalo',
                        rule: 'like + d (termina en e)'
                    },
                    {
                        words: ['The', 'game', 'started', 'at', 'three', "o'clock"],
                        hint: 'El juego empez√≥ a las tres',
                        rule: 'start + ed'
                    },
                    {
                        words: ['He', 'finished', 'his', 'homework', 'early'],
                        hint: '√âl termin√≥ su tarea temprano',
                        rule: 'finish + ed'
                    },
                    {
                        words: ['They', 'wanted', 'to', 'visit', 'the', 'museum'],
                        hint: 'Ellos quisieron visitar el museo',
                        rule: 'want + ed'
                    },
                    {
                        words: ['I', 'needed', 'help', 'with', 'my', 'project'],
                        hint: 'Yo necesit√© ayuda con mi proyecto',
                        rule: 'need + ed'
                    },
                    {
                        words: ['She', 'asked', 'a', 'very', 'good', 'question'],
                        hint: 'Ella hizo una muy buena pregunta',
                        rule: 'ask + ed'
                    },
                    {
                        words: ['He', 'answered', 'the', 'phone', 'immediately'],
                        hint: '√âl contest√≥ el tel√©fono inmediatamente',
                        rule: 'answer + ed'
                    },
                    {
                        words: ['My', 'friend', 'called', 'me', 'last', 'night'],
                        hint: 'Mi amigo me llam√≥ anoche',
                        rule: 'call + ed'
                    },
                    {
                        words: ['She', 'helped', 'her', 'mother', 'with', 'the', 'dishes'],
                        hint: 'Ella ayud√≥ a su madre con los platos',
                        rule: 'help + ed'
                    },
                    {
                        words: ['We', 'hoped', 'to', 'see', 'you', 'there'],
                        hint: 'Nosotros esper√°bamos verte all√≠',
                        rule: 'hope + d (termina en e)'
                    },
                    {
                        words: ['The', 'cat', 'jumped', 'over', 'the', 'fence'],
                        hint: 'El gato salt√≥ por encima de la cerca',
                        rule: 'jump + ed'
                    },
                    {
                        words: ['He', 'opened', 'the', 'window', 'for', 'fresh', 'air'],
                        hint: '√âl abri√≥ la ventana para aire fresco',
                        rule: 'open + ed'
                    },
                    {
                        words: ['She', 'closed', 'the', 'door', 'quietly'],
                        hint: 'Ella cerr√≥ la puerta silenciosamente',
                        rule: 'close + d (termina en e)'
                    },
                    {
                        words: ['It', 'rained', 'all', 'day', 'yesterday'],
                        hint: 'Llovi√≥ todo el d√≠a ayer',
                        rule: 'rain + ed'
                    },
                    {
                        words: ['We', 'enjoyed', 'the', 'concert', 'very', 'much'],
                        hint: 'Nosotros disfrutamos mucho el concierto',
                        rule: 'enjoy + ed (vocal + y)'
                    }
                ];
                
                this.currentLevel = 0;
                this.score = 0;
                this.timeElapsed = 0;
                this.timerInterval = null;
                this.userAnswer = [];
                this.draggedElement = null;
                
                this.init();
            }

            init() {
                this.startTimer();
                this.loadLevel();
                this.setupDragAndDrop();
            }

            startTimer() {
                this.timerInterval = setInterval(() => {
                    this.timeElapsed++;
                    const mins = Math.floor(this.timeElapsed / 60).toString().padStart(2, '0');
                    const secs = (this.timeElapsed % 60).toString().padStart(2, '0');
                    document.getElementById('timer').textContent = `${mins}:${secs}`;
                    
                    if (this.timeElapsed > 45) {
                        document.getElementById('timer').classList.add('warning');
                    }
                }, 1000);
            }

            loadLevel() {
                const level = this.levels[this.currentLevel];
                const container = document.getElementById('words-container');
                const answerArea = document.getElementById('answer-area');
                
                // Reset
                container.innerHTML = '';
                answerArea.innerHTML = '<span class="drop-zone-placeholder">Arrastra las palabras aqu√≠...</span>';
                answerArea.className = 'answer-area';
                this.userAnswer = [];
                
                // Update UI
                document.getElementById('level').textContent = this.currentLevel + 1;
                document.getElementById('score').textContent = this.score;
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('hint-box').classList.remove('show');
                
                // Shuffle words
                const shuffled = [...level.words].sort(() => Math.random() - 0.5);
                
                // Create word elements
                shuffled.forEach((word, index) => {
                    const wordEl = document.createElement('div');
                    wordEl.className = 'word';
                    wordEl.draggable = true;
                    wordEl.textContent = word;
                    wordEl.dataset.word = word;
                    wordEl.dataset.index = index;
                    
                    // Highlight past tense verbs
                    const pastVerbs = ['worked', 'played', 'studied', 'watched', 'walked', 'talked', 'looked', 'listened', 'cooked', 'cleaned', 'washed', 'danced', 'arrived', 'lived', 'loved', 'liked', 'started', 'finished', 'wanted', 'needed', 'asked', 'answered', 'called', 'helped', 'hoped', 'jumped', 'opened', 'closed', 'rained', 'enjoyed'];
                    if (pastVerbs.includes(word.toLowerCase())) {
                        wordEl.style.background = 'linear-gradient(135deg, #fef3c7, #fde68a)';
                        wordEl.style.borderColor = '#d97706';
                        wordEl.style.color = '#78350f';
                        wordEl.style.fontWeight = '800';
                    }
                    
                    // Highlight time expressions
                    const timeWords = ['yesterday', 'last', 'morning', 'night', 'Saturday', 'weekend', 'years', 'ago', 'o\'clock'];
                    if (timeWords.some(t => word.toLowerCase().includes(t))) {
                        wordEl.style.borderBottom = '3px solid #d97706';
                    }
                    
                    // Touch events for mobile
                    wordEl.addEventListener('touchstart', this.handleTouchStart.bind(this), {passive: false});
                    wordEl.addEventListener('touchmove', this.handleTouchMove.bind(this), {passive: false});
                    wordEl.addEventListener('touchend', this.handleTouchEnd.bind(this));
                    
                    container.appendChild(wordEl);
                });
                
                this.updateProgress();
            }

            setupDragAndDrop() {
                const container = document.getElementById('words-container');
                const answerArea = document.getElementById('answer-area');
                
                container.addEventListener('dragstart', (e) => {
                    if (e.target.classList.contains('word')) {
                        e.target.classList.add('dragging');
                        this.draggedElement = e.target;
                        e.dataTransfer.effectAllowed = 'move';
                    }
                });
                
                container.addEventListener('dragend', (e) => {
                    if (e.target.classList.contains('word')) {
                        e.target.classList.remove('dragging');
                    }
                });
                
                answerArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    answerArea.classList.add('drag-over');
                });
                
                answerArea.addEventListener('dragleave', () => {
                    answerArea.classList.remove('drag-over');
                });
                
                answerArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    answerArea.classList.remove('drag-over');
                    
                    if (this.draggedElement) {
                        this.addWordToAnswer(this.draggedElement);
                    }
                });
                
                // Allow removing words from answer
                answerArea.addEventListener('click', (e) => {
                    if (e.target.classList.contains('word')) {
                        this.removeWordFromAnswer(e.target);
                    }
                });
            }

            handleTouchStart(e) {
                const touch = e.touches[0];
                this.draggedElement = e.target;
                this.draggedElement.style.opacity = '0.5';
                
                this.touchOffset = {
                    x: touch.clientX - e.target.getBoundingClientRect().left,
                    y: touch.clientY - e.target.getBoundingClientRect().top
                };
            }

            handleTouchMove(e) {
                if (!this.draggedElement) return;
                e.preventDefault();
                
                const touch = e.touches[0];
                const answerArea = document.getElementById('answer-area');
                const rect = answerArea.getBoundingClientRect();
                
                if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
                    touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
                    answerArea.classList.add('drag-over');
                } else {
                    answerArea.classList.remove('drag-over');
                }
            }

            handleTouchEnd(e) {
                if (!this.draggedElement) return;
                
                this.draggedElement.style.opacity = '1';
                const touch = e.changedTouches[0];
                const answerArea = document.getElementById('answer-area');
                const rect = answerArea.getBoundingClientRect();
                
                if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
                    touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
                    this.addWordToAnswer(this.draggedElement);
                }
                
                answerArea.classList.remove('drag-over');
                this.draggedElement = null;
            }

            addWordToAnswer(wordEl) {
                const answerArea = document.getElementById('answer-area');
                
                if (answerArea.querySelector('.drop-zone-placeholder')) {
                    answerArea.innerHTML = '';
                }
                
                const clone = wordEl.cloneNode(true);
                clone.classList.remove('dragging');
                clone.style.opacity = '1';
                answerArea.appendChild(clone);
                
                wordEl.style.visibility = 'hidden';
                
                this.userAnswer.push(wordEl.dataset.word);
            }

            removeWordFromAnswer(wordEl) {
                const text = wordEl.textContent;
                const container = document.getElementById('words-container');
                
                const original = container.querySelector(`[data-word="${text}"]`);
                if (original) {
                    original.style.visibility = 'visible';
                }
                
                wordEl.remove();
                
                const index = this.userAnswer.indexOf(text);
                if (index > -1) {
                    this.userAnswer.splice(index, 1);
                }
                
                if (this.userAnswer.length === 0) {
                    document.getElementById('answer-area').innerHTML = 
                        '<span class="drop-zone-placeholder">Arrastra las palabras aqu√≠...</span>';
                }
            }

            checkAnswer() {
                const level = this.levels[this.currentLevel];
                const correctAnswer = level.words.join(' ');
                const userAttempt = this.userAnswer.join(' ');
                
                const answerArea = document.getElementById('answer-area');
                
                if (userAttempt === correctAnswer) {
                    answerArea.classList.add('correct');
                    this.score += Math.max(100 - (this.timeElapsed * 2), 10);
                    document.getElementById('score').textContent = this.score;
                    document.getElementById('next-btn').style.display = 'inline-block';
                    
                    answerArea.querySelectorAll('.word').forEach((word, i) => {
                        setTimeout(() => {
                            word.classList.add('placed');
                        }, i * 100);
                    });
                    
                    if (this.currentLevel === this.levels.length - 1 || (this.currentLevel + 1) % 5 === 0) {
                        this.celebrate();
                    }
                    
                    this.showNotification('¬°Correcto! üéâ', 'success');
                } else {
                    answerArea.classList.add('wrong');
                    setTimeout(() => {
                        answerArea.classList.remove('wrong');
                    }, 500);
                    this.showNotification('Int√©ntalo de nuevo üí™', 'error');
                }
            }

            showHint() {
                const level = this.levels[this.currentLevel];
                document.getElementById('hint-text').textContent = 
                    `${level.hint} (${level.rule})`;
                document.getElementById('hint-box').classList.add('show');
                this.score = Math.max(0, this.score - 5);
                document.getElementById('score').textContent = this.score;
            }

            resetLevel() {
                this.loadLevel();
            }

            nextLevel() {
                if (this.currentLevel < this.levels.length - 1) {
                    this.currentLevel++;
                    this.timeElapsed = 0;
                    document.getElementById('timer').classList.remove('warning');
                    this.loadLevel();
                } else {
                    this.showVictoryScreen();
                }
            }

            updateProgress() {
                const progress = ((this.currentLevel + 1) / this.levels.length) * 100;
                document.getElementById('progress').style.width = `${progress}%`;
            }

            celebrate() {
                const colors = ['#d97706', '#f59e0b', '#fbbf24', '#10b981', '#78350f'];
                
                for (let i = 0; i < 100; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.top = '-10px';
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.width = Math.random() * 10 + 5 + 'px';
                        confetti.style.height = Math.random() * 10 + 5 + 'px';
                        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                        confetti.style.position = 'fixed';
                        confetti.style.zIndex = '9999';
                        confetti.style.animation = `confetti-fall ${Math.random() * 3 + 2}s linear forwards`;
                        document.body.appendChild(confetti);
                        
                        setTimeout(() => confetti.remove(), 5000);
                    }, i * 20);
                }
            }

            showNotification(message, type) {
                const notif = document.createElement('div');
                notif.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${type === 'success' ? '#10b981' : '#ef4444'};
                    color: white;
                    padding: 1rem 2rem;
                    border-radius: 50px;
                    font-weight: 700;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                    z-index: 10000;
                    animation: slideDown 0.3s ease;
                `;
                notif.textContent = message;
                document.body.appendChild(notif);
                setTimeout(() => notif.remove(), 2000);
            }

            showVictoryScreen() {
                clearInterval(this.timerInterval);
                document.querySelector('.game-area').innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üèÜ</div>
                        <h2 style="color: #d97706; font-size: 2.5rem; margin-bottom: 1rem; font-family: 'Fredoka', sans-serif;">
                            ¬°Historiador del Pasado!
                        </h2>
                        <p style="font-size: 1.2rem; color: #78350f; margin-bottom: 2rem;">
                            Has completado las 30 oraciones en pasado<br>
                            Puntuaci√≥n final: <strong>${this.score}</strong>
                        </p>
                        <button class="btn-primary" onclick="location.reload()" style="font-size: 1.2rem;">
                            Jugar de nuevo üîÑ
                        </button>
                    </div>
                `;
                this.celebrate();
            }
        }

        const game = new PastSimpleGame();

        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { transform: translate(-50%, -100%); opacity: 0; }
                to { transform: translate(-50%, 0); opacity: 1; }
            }
            @keyframes confetti-fall {
                to {
                    transform: translateY(100vh) rotate(360deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>