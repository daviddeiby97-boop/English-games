<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrera de Verbos: Lista C</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            width: 100%;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 100;
        }

        h1 {
            color: #5a67d8;
            font-size: 1.7em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .subtitle {
            color: #4a5568;
            font-size: 0.85em;
            margin-top: 5px;
            font-weight: 600;
        }

        .game-wrapper {
            position: relative;
            width: 95%;
            max-width: 900px;
            margin: 15px auto;
        }

        .game-container {
            position: relative;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            border: 4px solid #5a67d8;
        }

        #gameCanvas {
            width: 100%;
            height: 320px;
            display: block;
            background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 50%, #90EE90 50%, #7CFC00 100%);
        }

        .hud {
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            padding: 0 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            pointer-events: none;
            z-index: 10;
        }

        .verb-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 25px;
            border-radius: 12px;
            border: 3px solid #5a67d8;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-align: center;
        }

        .verb-label {
            font-size: 0.75em;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 3px;
        }

        .verb-text {
            font-size: 2.2em;
            font-weight: bold;
            color: #2d3748;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 160px;
        }

        .stats-panel {
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: flex-end;
        }

        .stat-badge {
            background: rgba(255, 255, 255, 0.95);
            padding: 6px 12px;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
            font-weight: bold;
            color: #2d3748;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 0.9em;
        }

        .hearts {
            color: #e53e3e;
            font-size: 1.2em;
            letter-spacing: 2px;
        }

        .progress-container {
            position: absolute;
            top: 90px;
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            height: 18px;
            background: rgba(255,255,255,0.6);
            border-radius: 9px;
            border: 2px solid white;
            overflow: hidden;
            z-index: 10;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 9px;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.7em;
            font-weight: bold;
            color: #2d3748;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }

        .feedback-overlay {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4.5em;
            font-weight: bold;
            opacity: 0;
            pointer-events: none;
            z-index: 60;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }

        .feedback-overlay.show {
            animation: feedbackPop 0.6s ease-out;
        }

        @keyframes feedbackPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        .feedback-overlay.correct { color: #48bb78; }
        .feedback-overlay.wrong { color: #e53e3e; }

        .controls-area {
            background: #f7fafc;
            padding: 20px;
            border-top: 3px solid #e2e8f0;
            text-align: center;
        }

        .input-group {
            display: flex;
            gap: 12px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            max-width: 450px;
            margin: 0 auto;
        }

        .input-field {
            flex: 1;
            min-width: 180px;
            padding: 14px 18px;
            font-size: 1.2em;
            border: 3px solid #cbd5e0;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            color: #2d3748;
            text-transform: lowercase;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #5a67d8;
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.2);
        }

        .input-field.correct {
            border-color: #48bb78;
            background: #f0fff4;
            color: #22543d;
        }

        .input-field.wrong {
            border-color: #e53e3e;
            background: #fff5f5;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .btn-check {
            padding: 14px 28px;
            font-size: 1.1em;
            font-weight: bold;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 0 #4c51bf;
            transition: all 0.2s;
        }

        .btn-check:hover:not(:disabled) {
            background: #4c51bf;
            transform: translateY(-2px);
        }

        .btn-check:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #4c51bf;
        }

        .btn-check:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .hint-text {
            margin-top: 10px;
            color: #5a67d8;
            font-size: 0.85em;
            font-weight: 600;
            min-height: 20px;
        }

        .rules-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 12px;
            flex-wrap: wrap;
            font-size: 0.8em;
        }

        .rule-item {
            background: white;
            padding: 6px 12px;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
            color: #4a5568;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 20px;
            text-align: center;
            max-width: 480px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-icon {
            font-size: 3.5em;
            margin-bottom: 10px;
        }

        .modal-content h2 {
            color: #2d3748;
            margin-bottom: 12px;
            font-size: 1.6em;
        }

        .modal-content p {
            color: #4a5568;
            margin-bottom: 8px;
            line-height: 1.5;
            font-size: 0.95em;
        }

        .btn-modal {
            padding: 12px 30px;
            font-size: 1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            background: #5a67d8;
            color: white;
        }

        @media (max-width: 600px) {
            .verb-text { font-size: 1.8em; min-width: 140px; }
            .input-field { font-size: 1.1em; width: 100%; }
            .btn-check { width: 100%; }
            .input-group { flex-direction: column; }
            #gameCanvas { height: 280px; }
        }
    </style>
</head>
<body>
    <header>
        <h1>üèÉ‚Äç‚ôÇÔ∏è Carrera de Verbos C</h1>
        <div class="subtitle">Escribe el pasado de estos 56 verbos regulares</div>
    </header>

    <div class="game-wrapper">
        <div class="game-container">
            <canvas id="gameCanvas"></canvas>
            
            <div class="hud">
                <div class="verb-box">
                    <div class="verb-label">Verbo base:</div>
                    <div class="verb-text" id="verbDisplay">START</div>
                </div>
                
                <div class="stats-panel">
                    <div class="stat-badge">Score: <span id="scoreDisplay">0</span></div>
                    <div class="stat-badge hearts" id="heartsDisplay">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                    <div class="stat-badge"><span id="distanceDisplay">0</span>%</div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-text" id="progressText">0m / 100m</div>
            </div>

            <div class="feedback-overlay" id="feedback"></div>
        </div>

        <div class="controls-area">
            <div class="input-group">
                <input type="text" class="input-field" id="answerInput" placeholder="Ej: combed" autocomplete="off" disabled>
                <button class="btn-check" id="btnCheck" onclick="checkAnswer()" disabled>‚úì Verificar</button>
            </div>
            <div class="hint-text" id="hintText"></div>
            <div class="rules-bar">
                <div class="rule-item"><strong>+ed</strong> normal</div>
                <div class="rule-item"><strong>+d</strong> si termina en e</div>
                <div class="rule-item"><strong>-y+ied</strong> cons+y</div>
                <div class="rule-item"><strong>doble</strong> CVC</div>
            </div>
        </div>
    </div>

    <div class="modal-overlay active" id="startModal">
        <div class="modal-content">
            <div class="modal-icon">üèÅ</div>
            <h2>Carrera: Verbos C</h2>
            <p>Escribe la forma en <strong>Pasado Simple (-ed)</strong> de cada verbo.</p>
            <div style="background:#f7fafc; padding:15px; border-radius:10px; text-align:left; margin:15px 0; font-size:0.9em;">
                <p style="margin-bottom:8px;"><strong>Ejemplos de tu lista:</strong></p>
                <p>‚Ä¢ comb ‚Üí <strong>combed</strong></p>
                <p>‚Ä¢ copy ‚Üí <strong>copied</strong> (consonante+y)</p>
                <p>‚Ä¢ clip ‚Üí <strong>clipped</strong> (CVC)</p>
                <p>‚Ä¢ dance ‚Üí <strong>danced</strong> (e final)</p>
            </div>
            <p>¬°56 verbos para completar la carrera!</p>
            <button class="btn-modal" onclick="startGame()">¬°COMENZAR!</button>
        </div>
    </div>

    <div class="modal-overlay" id="endModal">
        <div class="modal-content">
            <div class="modal-icon" id="endIcon">üèÜ</div>
            <h2 id="endTitle">¬°Completado!</h2>
            <p id="endMessage"></p>
            <div style="font-size:1.8em; font-weight:bold; color:#5a67d8; margin:12px 0;">
                <span id="finalScore">0</span> pts
            </div>
            <button class="btn-modal" onclick="resetGame()">Jugar de Nuevo</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        function resize() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        let game = {
            active: false,
            score: 0,
            lives: 3,
            distance: 0,
            currentVerb: null,
            runner: { x: 50, y: 0, targetX: 50, frame: 0 },
            clouds: [],
            particles: []
        };

        // Los 56 verbos proporcionados con reglas espec√≠ficas
        const verbs = [
            // CVC (doble consonante)
            { base: "clip", past: "clipped", rule: "CVC: doble consonante" },
            { base: "clap", past: "clapped", rule: "CVC: doble consonante" },
            { base: "chop", past: "chopped", rule: "CVC: doble consonante" },
            
            // Consonante + y (-y+ied)
            { base: "copy", past: "copied", rule: "Consonante+y: -y+ied" },
            { base: "carry", past: "carried", rule: "Consonante+y: -y+ied" },
            { base: "cry", past: "cried", rule: "Consonante+y: -y+ied" },
            
            // Terminan en e (+d)
            { base: "curve", past: "curved", rule: "e final: +d" },
            { base: "cure", past: "cured", rule: "e final: +d" },
            { base: "decorate", past: "decorated", rule: "e final: +d" },
            { base: "deceive", past: "deceived", rule: "e final: +d" },
            { base: "close", past: "closed", rule: "e final: +d" },
            { base: "care", past: "cared", rule: "e final: +d" },
            { base: "compete", past: "competed", rule: "e final: +d" },
            { base: "change", past: "changed", rule: "e final: +d" },
            { base: "continue", past: "continued", rule: "e final: +d" },
            { base: "dare", past: "dared", rule: "e final: +d" },
            { base: "carve", past: "carved", rule: "e final: +d" },
            
            // Normales (+ed)
            { base: "comb", past: "combed", rule: "Normal: +ed" },
            { base: "cross", past: "crossed", rule: "Normal: +ed" },
            { base: "correct", past: "corrected", rule: "Normal: +ed" },
            { base: "challenge", past: "challenged", rule: "Normal: +ed" },
            { base: "deliver", past: "delivered", rule: "Normal: +ed" },
            { base: "concentrate", past: "concentrated", rule: "e final: +d" },
            { base: "connect", past: "connected", rule: "Normal: +ed" },
            { base: "crawl", past: "crawled", rule: "Normal: +ed" },
            { base: "complain", past: "complained", rule: "Normal: +ed" },
            { base: "choke", past: "choked", rule: "e final: +d" },
            { base: "clean", past: "cleaned", rule: "Normal: +ed" },
            { base: "contain", past: "contained", rule: "Normal: +ed" },
            { base: "crack", past: "cracked", rule: "Normal: +ed" },
            { base: "confuse", past: "confused", rule: "e final: +d" },
            { base: "dance", past: "danced", rule: "e final: +d" },
            { base: "cheer", past: "cheered", rule: "Normal: +ed" },
            { base: "chew", past: "chewed", rule: "Normal: +ed" },
            { base: "crash", past: "crashed", rule: "Normal: +ed" },
            { base: "compare", past: "compared", rule: "e final: +d" },
            { base: "decide", past: "decided", rule: "e final: +d" },
            { base: "cheat", past: "cheated", rule: "Normal: +ed" },
            { base: "cause", past: "caused", rule: "e final: +d" },
            { base: "charge", past: "charged", rule: "e final: +d" },
            { base: "delay", past: "delayed", rule: "Normal: +ed (vocal+y)" },
            { base: "claim", past: "claimed", rule: "Normal: +ed" },
            { base: "check", past: "checked", rule: "Normal: +ed" },
            { base: "confess", past: "confessed", rule: "Normal: +ed" },
            { base: "consider", past: "considered", rule: "Normal: +ed" },
            { base: "cycle", past: "cycled", rule: "e final: +d" },
            { base: "curl", past: "curled", rule: "Normal: +ed" },
            { base: "cough", past: "coughed", rule: "Normal: +ed" },
            { base: "count", past: "counted", rule: "Normal: +ed" },
            { base: "clear", past: "cleared", rule: "Normal: +ed" },
            { base: "crush", past: "crushed", rule: "Normal: +ed" },
            { base: "concern", past: "concerned", rule: "Normal: +ed" },
            { base: "chase", past: "chased", rule: "e final: +d" },
            { base: "consist", past: "consisted", rule: "Normal: +ed" },
            { base: "colour", past: "coloured", rule: "Normal: +ed" },
            { base: "complete", past: "completed", rule: "e final: +d" },
            { base: "damage", past: "damaged", rule: "e final: +d" },
            { base: "collect", past: "collected", rule: "Normal: +ed" },
            { base: "command", past: "commanded", rule: "Normal: +ed" }
        ];

        let availableVerbs = [];

        function initClouds() {
            game.clouds = [];
            for (let i = 0; i < 6; i++) {
                game.clouds.push({
                    x: Math.random() * canvas.width,
                    y: 20 + Math.random() * 60,
                    speed: 0.3 + Math.random() * 0.4,
                    size: 25 + Math.random() * 15
                });
            }
        }

        function spawnParticles(x, y, color) {
            for (let i = 0; i < 15; i++) {
                game.particles.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 12,
                    vy: -Math.random() * 8 - 2,
                    life: 40, color: color, size: 4 + Math.random() * 4
                });
            }
        }

        function update() {
            game.clouds.forEach(cloud => {
                cloud.x -= cloud.speed;
                if (cloud.x < -100) cloud.x = canvas.width + 50;
            });

            game.particles = game.particles.filter(p => p.life > 0);
            game.particles.forEach(p => {
                p.x += p.vx; p.y += p.vy; p.vy += 0.3; p.life--;
            });

            if (Math.abs(game.runner.targetX - game.runner.x) > 1) {
                game.runner.x += (game.runner.targetX - game.runner.x) * 0.08;
                game.runner.frame += 0.3;
            } else {
                game.runner.frame = 0;
            }
        }

        function drawRunner() {
            const x = game.runner.x;
            const y = canvas.height - 110;
            const legSwing = Math.sin(game.runner.frame) * 15;
            
            ctx.save();
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.ellipse(x + 20, y + 45, 16, 4, 0, 0, Math.PI * 2);
            ctx.fill();
            
            let bodyColor = '#5a67d8';
            if (game.lives === 2) bodyColor = '#ed8936';
            if (game.lives === 1) bodyColor = '#e53e3e';
            
            ctx.strokeStyle = '#2d3748';
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            
            ctx.beginPath();
            ctx.moveTo(x + 20, y + 25);
            ctx.lineTo(x + 20 - legSwing, y + 42);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(x + 20, y + 25);
            ctx.lineTo(x + 20 + legSwing, y + 42);
            ctx.stroke();
            
            ctx.fillStyle = bodyColor;
            ctx.fillRect(x + 10, y + 8, 20, 22);
            
            ctx.fillStyle = '#fbd38d';
            ctx.beginPath();
            ctx.arc(x + 20, y + 5, 10, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#2d3748';
            ctx.beginPath();
            ctx.arc(x + 23, y + 2, 2, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = '#fbd38d';
            ctx.lineWidth = 3;
            const armSwing = Math.cos(game.runner.frame) * 10;
            
            ctx.beginPath();
            ctx.moveTo(x + 15, y + 12);
            ctx.lineTo(x + 7 + armSwing, y + 20);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(x + 25, y + 12);
            ctx.lineTo(x + 33 - armSwing, y + 20);
            ctx.stroke();
            
            ctx.restore();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const groundY = canvas.height - 65;
            
            ctx.fillStyle = '#7CFC00';
            ctx.fillRect(0, groundY, canvas.width, 65);
            
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.setLineDash([20, 15]);
            ctx.beginPath();
            ctx.moveTo(0, groundY + 32);
            ctx.lineTo(canvas.width, groundY + 32);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            game.clouds.forEach(cloud => {
                ctx.beginPath();
                ctx.arc(cloud.x, cloud.y, cloud.size, 0, Math.PI * 2);
                ctx.arc(cloud.x + cloud.size * 0.7, cloud.y, cloud.size * 0.8, 0, Math.PI * 2);
                ctx.arc(cloud.x + cloud.size * 1.4, cloud.y, cloud.size * 0.6, 0, Math.PI * 2);
                ctx.fill();
            });
            
            ctx.fillStyle = '#2d3748';
            ctx.font = 'bold 11px Arial';
            for (let i = 0; i <= 100; i += 20) {
                const markX = 50 + (i / 100) * (canvas.width - 130);
                ctx.fillRect(markX, groundY, 2, 12);
                ctx.fillText(i + 'm', markX - 8, groundY + 25);
            }
            
            const finishX = canvas.width - 70;
            ctx.fillStyle = '#e53e3e';
            ctx.fillRect(finishX, groundY - 70, 4, 70);
            
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    ctx.fillStyle = (row + col) % 2 === 0 ? '#fff' : '#2d3748';
                    ctx.fillRect(finishX + 4 + (col * 8), groundY - 70 + (row * 8), 8, 8);
                }
            }
            
            ctx.save();
            ctx.translate(finishX, groundY - 80);
            ctx.rotate(-Math.PI / 12);
            ctx.fillStyle = '#e53e3e';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('META', 0, 0);
            ctx.restore();
            
            game.particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / 40;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            });
            ctx.globalAlpha = 1;
            
            drawRunner();
        }

        function loop() {
            if (game.active) {
                update();
                draw();
            }
            requestAnimationFrame(loop);
        }

        function nextVerb() {
            if (availableVerbs.length === 0) {
                availableVerbs = [...verbs].sort(() => Math.random() - 0.5);
            }
            
            game.currentVerb = availableVerbs.pop();
            
            document.getElementById('verbDisplay').textContent = game.currentVerb.base.toUpperCase();
            document.getElementById('hintText').textContent = 'üí° Regla: ' + game.currentVerb.rule;
            
            const input = document.getElementById('answerInput');
            input.value = '';
            input.disabled = false;
            input.focus();
            input.className = 'input-field';
            input.style.textDecoration = 'none';
            
            document.getElementById('btnCheck').disabled = false;
        }

        function checkAnswer() {
            if (!game.active) return;
            
            const input = document.getElementById('answerInput');
            const userAnswer = input.value.trim().toLowerCase();
            const correctAnswer = game.currentVerb.past.toLowerCase();
            const feedback = document.getElementById('feedback');
            
            if (!userAnswer) return;
            
            document.getElementById('btnCheck').disabled = true;
            input.disabled = true;
            
            if (userAnswer === correctAnswer) {
                game.score += 10;
                game.distance += (100 / 56);
                
                const maxX = canvas.width - 90;
                const startX = 50;
                game.runner.targetX = startX + (game.distance / 100) * (maxX - startX);
                
                feedback.textContent = '‚úÖ';
                feedback.className = 'feedback-overlay show correct';
                input.className = 'input-field correct';
                spawnParticles(game.runner.x + 20, canvas.height - 130, '#48bb78');
                
                updateUI();
                
                if (game.distance >= 99) {
                    setTimeout(winGame, 800);
                } else {
                    setTimeout(() => {
                        feedback.classList.remove('show');
                        nextVerb();
                    }, 800);
                }
            } else {
                game.lives--;
                updateUI();
                
                feedback.textContent = '‚ùå';
                feedback.className = 'feedback-overlay show wrong';
                input.className = 'input-field wrong';
                input.value = correctAnswer;
                input.style.textDecoration = 'line-through';
                
                spawnParticles(game.runner.x + 20, canvas.height - 130, '#e53e3e');
                canvas.style.filter = 'brightness(0.7) sepia(1) hue-rotate(-50deg) saturate(5)';
                setTimeout(() => canvas.style.filter = 'none', 300);
                
                if (game.lives <= 0) {
                    setTimeout(gameOver, 1200);
                } else {
                    setTimeout(() => {
                        feedback.classList.remove('show');
                        input.style.textDecoration = 'none';
                        input.className = 'input-field';
                        nextVerb();
                    }, 1200);
                }
            }
        }

        function updateUI() {
            document.getElementById('scoreDisplay').textContent = game.score;
            document.getElementById('distanceDisplay').textContent = Math.min(Math.floor(game.distance), 100);
            document.getElementById('progressBar').style.width = Math.min(game.distance, 100) + '%';
            document.getElementById('progressText').textContent = `${Math.min(Math.floor(game.distance), 100)}m / 100m`;
            
            let hearts = '';
            for (let i = 0; i < game.lives; i++) hearts += '‚ù§Ô∏è';
            for (let i = game.lives; i < 3; i++) hearts += 'üñ§';
            document.getElementById('heartsDisplay').textContent = hearts;
        }

        function startGame() {
            document.getElementById('startModal').classList.remove('active');
            
            game.active = true;
            game.score = 0;
            game.lives = 3;
            game.distance = 0;
            game.runner.x = 50;
            game.runner.targetX = 50;
            game.runner.frame = 0;
            
            availableVerbs = [...verbs].sort(() => Math.random() - 0.5);
            
            initClouds();
            updateUI();
            nextVerb();
        }

        function winGame() {
            game.active = false;
            document.getElementById('endIcon').textContent = 'üèÜ';
            document.getElementById('endTitle').textContent = '¬°CARRERA COMPLETADA!';
            document.getElementById('endMessage').textContent = `Has dominado los ${verbs.length} verbos de la lista C.`;
            document.getElementById('finalScore').textContent = game.score;
            document.getElementById('endModal').classList.add('active');
        }

        function gameOver() {
            game.active = false;
            document.getElementById('endIcon').textContent = 'üíî';
            document.getElementById('endTitle').textContent = 'GAME OVER';
            document.getElementById('endMessage').textContent = `Llegaste a ${Math.floor(game.distance)}m. ¬°Int√©ntalo de nuevo!`;
            document.getElementById('finalScore').textContent = game.score;
            document.getElementById('endModal').classList.add('active');
        }

        function resetGame() {
            document.getElementById('endModal').classList.remove('active');
            document.getElementById('startModal').classList.add('active');
            
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').disabled = true;
            document.getElementById('btnCheck').disabled = true;
            game.distance = 0;
            game.runner.x = 50;
            game.runner.targetX = 50;
            draw();
        }

        document.getElementById('answerInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('btnCheck').disabled) {
                checkAnswer();
            }
        });

        initClouds();
        loop();
    </script>
</body>
</html>