<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentence Master - Past Simple Interrogative</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Nunito:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0891b2;
            --primary-dark: #0e7490;
            --secondary: #f97316;
            --accent: #06b6d4;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --dark: #164e63;
            --light: #ecfeff;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 50%, #f97316 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.3;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            max-width: 900px;
            width: 90%;
            position: relative;
            z-index: 10;
            border: 2px solid rgba(8, 145, 178, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-family: 'Fredoka', sans-serif;
            font-size: 3rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            color: #155e75;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .mode-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-weight: 700;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 4px 6px -1px rgba(249, 115, 22, 0.5);
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--dark), #155e75);
            padding: 1rem 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            color: #ecfeff;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Fredoka', sans-serif;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .game-area {
            background: #ecfeff;
            border-radius: 20px;
            padding: 2rem;
            min-height: 300px;
            position: relative;
            overflow: hidden;
            border: 3px solid #a5f3fc;
        }

        .question-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 1rem;
            letter-spacing: 0.05em;
            background: #cffafe;
            color: #155e75;
            border: 2px solid #67e8f9;
        }

        .instruction {
            text-align: center;
            color: #164e63;
            margin-bottom: 2rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .grammar-tip {
            background: #ecfeff;
            border-left: 4px solid var(--primary);
            padding: 1rem;
            border-radius: 0 10px 10px 0;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            color: #155e75;
            line-height: 1.6;
        }

        .words-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
            min-height: 60px;
            padding: 1rem;
            background: white;
            border-radius: 15px;
            border: 2px dashed #67e8f9;
            transition: all 0.3s ease;
        }

        .words-container.drag-over {
            background: #ecfeff;
            border-color: var(--primary);
            transform: scale(1.02);
        }

        .word {
            background: linear-gradient(135deg, #ffffff, #ecfeff);
            border: 2px solid #a5f3fc;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            cursor: move;
            font-weight: 700;
            font-size: 1.1rem;
            color: #164e63;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        .word::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .word:hover {
            transform: translateY(-2px) rotate(2deg);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
            background: linear-gradient(135deg, #cffafe, #a5f3fc);
        }

        .word:hover::before {
            left: 100%;
        }

        .word.dragging {
            opacity: 0.5;
            transform: scale(1.1);
            cursor: grabbing;
        }

        .word.placed {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            border-color: transparent;
            animation: placeWord 0.5s ease;
        }

        @keyframes placeWord {
            0% { transform: scale(1.2); }
            50% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        .answer-area {
            background: white;
            border: 3px solid #67e8f9;
            border-radius: 15px;
            padding: 2rem;
            min-height: 100px;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .answer-area.correct {
            border-color: var(--success);
            background: #f0fdf4;
            animation: correctPulse 0.6s ease;
        }

        .answer-area.wrong {
            border-color: var(--error);
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .drop-zone-placeholder {
            color: #0891b2;
            font-style: italic;
            pointer-events: none;
            opacity: 0.7;
        }

        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        button {
            font-family: 'Nunito', sans-serif;
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 6px -1px rgba(8, 145, 178, 0.5);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(8, 145, 178, 0.5);
        }

        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 2px solid #a5f3fc;
        }

        .btn-secondary:hover {
            background: #ecfeff;
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.5);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(16, 185, 129, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecfeff;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 2rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .hint-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid var(--warning);
            padding: 1rem;
            border-radius: 0 10px 10px 0;
            margin-top: 1rem;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .hint-box.show {
            display: block;
        }

        .timer {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--secondary);
        }

        .timer.warning {
            color: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (max-width: 640px) {
            h1 { font-size: 2rem; }
            .game-container { padding: 1.5rem; }
            .word { padding: 0.5rem 1rem; font-size: 1rem; }
            .stats-bar { flex-direction: column; gap: 1rem; }
        }

        .floating-icon {
            position: absolute;
            opacity: 0.1;
            font-size: 4rem;
            animation: float 6s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="floating-icon" style="top: 10%; left: 10%;">‚ùì</div>
        <div class="floating-icon" style="bottom: 10%; right: 10%; animation-delay: -2s;">‚è∞</div>
        
        <header class="header">
            <h1>‚ùì Past Questions</h1>
            <p class="subtitle">Ordena las preguntas en pasado</p>
            <span class="mode-badge">Modo: Past Simple Interrogativo</span>
        </header>

        <div class="stats-bar">
            <div class="stat">
                <span class="stat-value" id="level">1</span>
                <span class="stat-label">Nivel</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="score">0</span>
                <span class="stat-label">Puntos</span>
            </div>
            <div class="timer" id="timer">00:00</div>
        </div>

        <div class="game-area">
            <span class="question-badge">‚ùì Pregunta en Pasado</span>
            
            <div class="grammar-tip">
                <strong>Estructura:</strong> Did + sujeto + verbo base... ?<br>
                <strong>Wh-Questions:</strong> Wh-word + did + sujeto + verbo base... ?
            </div>

            <p class="instruction" id="instruction">
                Arrastra las palabras para formar la pregunta correcta en pasado
            </p>

            <div class="answer-area" id="answer-area">
                <span class="drop-zone-placeholder">Arrastra las palabras aqu√≠...</span>
            </div>

            <div class="words-container" id="words-container">
                <!-- Las palabras se generar√°n aqu√≠ -->
            </div>

            <div class="hint-box" id="hint-box">
                üí° <strong>Traducci√≥n:</strong> <span id="hint-text"></span>
            </div>
        </div>

        <div class="controls">
            <button class="btn-secondary" onclick="game.showHint()">
                üí° Pista (-5 pts)
            </button>
            <button class="btn-secondary" onclick="game.resetLevel()">
                üîÑ Reintentar
            </button>
            <button class="btn-success" onclick="game.checkAnswer()">
                ‚úì Verificar
            </button>
            <button class="btn-primary" onclick="game.nextLevel()" id="next-btn" style="display: none;">
                Siguiente ‚ûú
            </button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
    </div>

    <script>
        class PastQuestionGame {
            constructor() {
                this.levels = [
                    {
                        words: ['Did', 'you', 'go', 'to', 'the', 'party', '?'],
                        hint: '¬øFuiste a la fiesta?',
                        rule: 'Did + you + go...?'
                    },
                    {
                        words: ['What', 'did', 'he', 'say', '?'],
                        hint: '¬øQu√© dijo √©l?',
                        rule: 'What + did + he + say...?'
                    },
                    {
                        words: ['Did', 'she', 'study', 'for', 'the', 'exam', '?'],
                        hint: '¬øElla estudi√≥ para el examen?',
                        rule: 'Did + she + study...?'
                    },
                    {
                        words: ['Where', 'did', 'they', 'live', '?'],
                        hint: '¬øD√≥nde vivieron ellos?',
                        rule: 'Where + did + they + live...?'
                    },
                    {
                        words: ['Did', 'it', 'rain', 'yesterday', '?'],
                        hint: '¬øLlovi√≥ ayer?',
                        rule: 'Did + it + rain...?'
                    },
                    {
                        words: ['When', 'did', 'you', 'arrive', '?'],
                        hint: '¬øCu√°ndo llegaste?',
                        rule: 'When + did + you + arrive...?'
                    },
                    {
                        words: ['Did', 'he', 'watch', 'the', 'movie', '?'],
                        hint: '¬ø√âl vio la pel√≠cula?',
                        rule: 'Did + he + watch...?'
                    },
                    {
                        words: ['Why', 'did', 'she', 'leave', 'early', '?'],
                        hint: '¬øPor qu√© ella se fue temprano?',
                        rule: 'Why + did + she + leave...?'
                    },
                    {
                        words: ['Did', 'we', 'finish', 'the', 'project', '?'],
                        hint: '¬øTerminamos el proyecto?',
                        rule: 'Did + we + finish...?'
                    },
                    {
                        words: ['How', 'did', 'you', 'get', 'there', '?'],
                        hint: '¬øC√≥mo llegaste all√≠?',
                        rule: 'How + did + you + get...?'
                    },
                    {
                        words: ['Did', 'they', 'enjoy', 'the', 'concert', '?'],
                        hint: '¬øEllos disfrutaron el concierto?',
                        rule: 'Did + they + enjoy...?'
                    },
                    {
                        words: ['Who', 'did', 'she', 'meet', '?'],
                        hint: '¬øA qui√©n conoci√≥ ella?',
                        rule: 'Who + did + she + meet...?'
                    },
                    {
                        words: ['Did', 'the', 'train', 'arrive', 'on', 'time', '?'],
                        hint: '¬øEl tren lleg√≥ a tiempo?',
                        rule: 'Did + it + arrive...?'
                    },
                    {
                        words: ['What', 'time', 'did', 'you', 'wake', 'up', '?'],
                        hint: '¬øA qu√© hora despertaste?',
                        rule: 'What time + did + you + wake...?'
                    },
                    {
                        words: ['Did', 'he', 'call', 'you', 'last', 'night', '?'],
                        hint: '¬ø√âl te llam√≥ anoche?',
                        rule: 'Did + he + call...?'
                    },
                    {
                        words: ['How', 'much', 'did', 'it', 'cost', '?'],
                        hint: '¬øCu√°nto cost√≥?',
                        rule: 'How much + did + it + cost...?'
                    },
                    {
                        words: ['Did', 'she', 'buy', 'anything', '?'],
                        hint: '¬øElla compr√≥ algo?',
                        rule: 'Did + she + buy...?'
                    },
                    {
                        words: ['Where', 'did', 'he', 'work', '?'],
                        hint: '¬øD√≥nde trabaj√≥ √©l?',
                        rule: 'Where + did + he + work...?'
                    },
                    {
                        words: ['Did', 'you', 'see', 'anybody', 'there', '?'],
                        hint: '¬øViste a alguien all√≠?',
                        rule: 'Did + you + see...?'
                    },
                    {
                        words: ['Which', 'one', 'did', 'you', 'choose', '?'],
                        hint: '¬øCu√°l elegiste?',
                        rule: 'Which + did + you + choose...?'
                    },
                    {
                        words: ['Did', 'it', 'happen', 'again', '?'],
                        hint: '¬øSucedi√≥ otra vez?',
                        rule: 'Did + it + happen...?'
                    },
                    {
                        words: ['How', 'long', 'did', 'they', 'stay', '?'],
                        hint: '¬øCu√°nto tiempo se quedaron?',
                        rule: 'How long + did + they + stay...?'
                    },
                    {
                        words: ['Did', 'she', 'cook', 'dinner', '?'],
                        hint: '¬øElla cocin√≥ la cena?',
                        rule: 'Did + she + cook...?'
                    },
                    {
                        words: ['What', 'did', 'you', 'do', '?'],
                        hint: '¬øQu√© hiciste?',
                        rule: 'What + did + you + do...?'
                    },
                    {
                        words: ['Did', 'he', 'take', 'the', 'bus', '?'],
                        hint: '¬ø√âl tom√≥ el autob√∫s?',
                        rule: 'Did + he + take...?'
                    },
                    {
                        words: ['Why', 'did', 'they', 'move', '?'],
                        hint: '¬øPor qu√© se mudaron?',
                        rule: 'Why + did + they + move...?'
                    },
                    {
                        words: ['Did', 'you', 'find', 'your', 'keys', '?'],
                        hint: '¬øEncontraste tus llaves?',
                        rule: 'Did + you + find...?'
                    },
                    {
                        words: ['Who', 'did', 'he', 'talk', 'to', '?'],
                        hint: '¬øCon qui√©n habl√≥ √©l?',
                        rule: 'Who + did + he + talk...?'
                    },
                    {
                        words: ['Did', 'she', 'answer', 'the', 'question', '?'],
                        hint: '¬øElla respondi√≥ la pregunta?',
                        rule: 'Did + she + answer...?'
                    },
                    {
                        words: ['How', 'did', 'it', 'end', '?'],
                        hint: '¬øC√≥mo termin√≥?',
                        rule: 'How + did + it + end...?'
                    }
                ];
                
                this.currentLevel = 0;
                this.score = 0;
                this.timeElapsed = 0;
                this.timerInterval = null;
                this.userAnswer = [];
                this.draggedElement = null;
                
                this.init();
            }

            init() {
                this.startTimer();
                this.loadLevel();
                this.setupDragAndDrop();
            }

            startTimer() {
                this.timerInterval = setInterval(() => {
                    this.timeElapsed++;
                    const mins = Math.floor(this.timeElapsed / 60).toString().padStart(2, '0');
                    const secs = (this.timeElapsed % 60).toString().padStart(2, '0');
                    document.getElementById('timer').textContent = `${mins}:${secs}`;
                    
                    if (this.timeElapsed > 45) {
                        document.getElementById('timer').classList.add('warning');
                    }
                }, 1000);
            }

            loadLevel() {
                const level = this.levels[this.currentLevel];
                const container = document.getElementById('words-container');
                const answerArea = document.getElementById('answer-area');
                
                // Reset
                container.innerHTML = '';
                answerArea.innerHTML = '<span class="drop-zone-placeholder">Arrastra las palabras aqu√≠...</span>';
                answerArea.className = 'answer-area';
                this.userAnswer = [];
                
                // Update UI
                document.getElementById('level').textContent = this.currentLevel + 1;
                document.getElementById('score').textContent = this.score;
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('hint-box').classList.remove('show');
                
                // Shuffle words
                const shuffled = [...level.words].sort(() => Math.random() - 0.5);
                
                // Create word elements
                shuffled.forEach((word, index) => {
                    const wordEl = document.createElement('div');
                    wordEl.className = 'word';
                    wordEl.draggable = true;
                    wordEl.textContent = word;
                    wordEl.dataset.word = word;
                    wordEl.dataset.index = index;
                    
                    // Highlight Did
                    if (word.toLowerCase() === 'did') {
                        wordEl.style.background = 'linear-gradient(135deg, #cffafe, #a5f3fc)';
                        wordEl.style.borderColor = '#0891b2';
                        wordEl.style.color = '#155e75';
                        wordEl.style.fontWeight = '800';
                    }
                    
                    // Highlight ?
                    if (word === '?') {
                        wordEl.style.fontSize = '1.5rem';
                        wordEl.style.background = 'linear-gradient(135deg, #fed7aa, #fdba74)';
                        wordEl.style.borderColor = '#f97316';
                        wordEl.style.color = '#9a3412';
                    }
                    
                    // Highlight Wh- words
                    const whWords = ['what', 'where', 'when', 'why', 'who', 'how', 'which'];
                    if (whWords.includes(word.toLowerCase())) {
                        wordEl.style.background = 'linear-gradient(135deg, #fef3c7, #fde68a)';
                        wordEl.style.borderColor = '#f59e0b';
                        wordEl.style.color = '#92400e';
                    }
                    
                    // Touch events for mobile
                    wordEl.addEventListener('touchstart', this.handleTouchStart.bind(this), {passive: false});
                    wordEl.addEventListener('touchmove', this.handleTouchMove.bind(this), {passive: false});
                    wordEl.addEventListener('touchend', this.handleTouchEnd.bind(this));
                    
                    container.appendChild(wordEl);
                });
                
                this.updateProgress();
            }

            setupDragAndDrop() {
                const container = document.getElementById('words-container');
                const answerArea = document.getElementById('answer-area');
                
                container.addEventListener('dragstart', (e) => {
                    if (e.target.classList.contains('word')) {
                        e.target.classList.add('dragging');
                        this.draggedElement = e.target;
                        e.dataTransfer.effectAllowed = 'move';
                    }
                });
                
                container.addEventListener('dragend', (e) => {
                    if (e.target.classList.contains('word')) {
                        e.target.classList.remove('dragging');
                    }
                });
                
                answerArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    answerArea.classList.add('drag-over');
                });
                
                answerArea.addEventListener('dragleave', () => {
                    answerArea.classList.remove('drag-over');
                });
                
                answerArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    answerArea.classList.remove('drag-over');
                    
                    if (this.draggedElement) {
                        this.addWordToAnswer(this.draggedElement);
                    }
                });
                
                // Allow removing words from answer
                answerArea.addEventListener('click', (e) => {
                    if (e.target.classList.contains('word')) {
                        this.removeWordFromAnswer(e.target);
                    }
                });
            }

            handleTouchStart(e) {
                const touch = e.touches[0];
                this.draggedElement = e.target;
                this.draggedElement.style.opacity = '0.5';
                
                this.touchOffset = {
                    x: touch.clientX - e.target.getBoundingClientRect().left,
                    y: touch.clientY - e.target.getBoundingClientRect().top
                };
            }

            handleTouchMove(e) {
                if (!this.draggedElement) return;
                e.preventDefault();
                
                const touch = e.touches[0];
                const answerArea = document.getElementById('answer-area');
                const rect = answerArea.getBoundingClientRect();
                
                if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
                    touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
                    answerArea.classList.add('drag-over');
                } else {
                    answerArea.classList.remove('drag-over');
                }
            }

            handleTouchEnd(e) {
                if (!this.draggedElement) return;
                
                this.draggedElement.style.opacity = '1';
                const touch = e.changedTouches[0];
                const answerArea = document.getElementById('answer-area');
                const rect = answerArea.getBoundingClientRect();
                
                if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
                    touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
                    this.addWordToAnswer(this.draggedElement);
                }
                
                answerArea.classList.remove('drag-over');
                this.draggedElement = null;
            }

            addWordToAnswer(wordEl) {
                const answerArea = document.getElementById('answer-area');
                
                if (answerArea.querySelector('.drop-zone-placeholder')) {
                    answerArea.innerHTML = '';
                }
                
                const clone = wordEl.cloneNode(true);
                clone.classList.remove('dragging');
                clone.style.opacity = '1';
                answerArea.appendChild(clone);
                
                wordEl.style.visibility = 'hidden';
                
                this.userAnswer.push(wordEl.dataset.word);
            }

            removeWordFromAnswer(wordEl) {
                const text = wordEl.textContent;
                const container = document.getElementById('words-container');
                
                const original = container.querySelector(`[data-word="${text}"]`);
                if (original) {
                    original.style.visibility = 'visible';
                }
                
                wordEl.remove();
                
                const index = this.userAnswer.indexOf(text);
                if (index > -1) {
                    this.userAnswer.splice(index, 1);
                }
                
                if (this.userAnswer.length === 0) {
                    document.getElementById('answer-area').innerHTML = 
                        '<span class="drop-zone-placeholder">Arrastra las palabras aqu√≠...</span>';
                }
            }

            checkAnswer() {
                const level = this.levels[this.currentLevel];
                const correctAnswer = level.words.join(' ');
                const userAttempt = this.userAnswer.join(' ');
                
                const answerArea = document.getElementById('answer-area');
                
                if (userAttempt === correctAnswer) {
                    answerArea.classList.add('correct');
                    this.score += Math.max(100 - (this.timeElapsed * 2), 10);
                    document.getElementById('score').textContent = this.score;
                    document.getElementById('next-btn').style.display = 'inline-block';
                    
                    answerArea.querySelectorAll('.word').forEach((word, i) => {
                        setTimeout(() => {
                            word.classList.add('placed');
                        }, i * 100);
                    });
                    
                    if (this.currentLevel === this.levels.length - 1 || (this.currentLevel + 1) % 5 === 0) {
                        this.celebrate();
                    }
                    
                    this.showNotification('¬°Correcto! üéâ', 'success');
                } else {
                    answerArea.classList.add('wrong');
                    setTimeout(() => {
                        answerArea.classList.remove('wrong');
                    }, 500);
                    this.showNotification('Int√©ntalo de nuevo üí™', 'error');
                }
            }

            showHint() {
                const level = this.levels[this.currentLevel];
                document.getElementById('hint-text').textContent = 
                    `${level.hint} (${level.rule})`;
                document.getElementById('hint-box').classList.add('show');
                this.score = Math.max(0, this.score - 5);
                document.getElementById('score').textContent = this.score;
            }

            resetLevel() {
                this.loadLevel();
            }

            nextLevel() {
                if (this.currentLevel < this.levels.length - 1) {
                    this.currentLevel++;
                    this.timeElapsed = 0;
                    document.getElementById('timer').classList.remove('warning');
                    this.loadLevel();
                } else {
                    this.showVictoryScreen();
                }
            }

            updateProgress() {
                const progress = ((this.currentLevel + 1) / this.levels.length) * 100;
                document.getElementById('progress').style.width = `${progress}%`;
            }

            celebrate() {
                const colors = ['#0891b2', '#06b6d4', '#f97316', '#f59e0b', '#10b981'];
                
                for (let i = 0; i < 100; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.top = '-10px';
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.width = Math.random() * 10 + 5 + 'px';
                        confetti.style.height = Math.random() * 10 + 5 + 'px';
                        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                        confetti.style.position = 'fixed';
                        confetti.style.zIndex = '9999';
                        confetti.style.animation = `confetti-fall ${Math.random() * 3 + 2}s linear forwards`;
                        document.body.appendChild(confetti);
                        
                        setTimeout(() => confetti.remove(), 5000);
                    }, i * 20);
                }
            }

            showNotification(message, type) {
                const notif = document.createElement('div');
                notif.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${type === 'success' ? '#10b981' : '#ef4444'};
                    color: white;
                    padding: 1rem 2rem;
                    border-radius: 50px;
                    font-weight: 700;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                    z-index: 10000;
                    animation: slideDown 0.3s ease;
                `;
                notif.textContent = message;
                document.body.appendChild(notif);
                setTimeout(() => notif.remove(), 2000);
            }

            showVictoryScreen() {
                clearInterval(this.timerInterval);
                document.querySelector('.game-area').innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üèÜ</div>
                        <h2 style="color: #0891b2; font-size: 2.5rem; margin-bottom: 1rem; font-family: 'Fredoka', sans-serif;">
                            ¬°Detective del Pasado!
                        </h2>
                        <p style="font-size: 1.2rem; color: #155e75; margin-bottom: 2rem;">
                            Has completado las 30 preguntas en pasado<br>
                            Puntuaci√≥n final: <strong>${this.score}</strong>
                        </p>
                        <button class="btn-primary" onclick="location.reload()" style="font-size: 1.2rem;">
                            Jugar de nuevo üîÑ
                        </button>
                    </div>
                `;
                this.celebrate();
            }
        }

        const game = new PastQuestionGame();

        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { transform: translate(-50%, -100%); opacity: 0; }
                to { transform: translate(-50%, 0); opacity: 1; }
            }
            @keyframes confetti-fall {
                to {
                    transform: translateY(100vh) rotate(360deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>