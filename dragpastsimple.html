<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Past Simple: Drag & Drop Regular Verbs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
            user-select: none;
            -webkit-user-select: none;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        header {
            text-align: center;
            margin-bottom: 15px;
        }

        h1 {
            color: #e53e3e;
            font-size: 1.7em;
            margin-bottom: 5px;
        }

        .section-indicator {
            display: inline-block;
            background: #fef5e7;
            padding: 6px 18px;
            border-radius: 20px;
            font-weight: bold;
            color: #c05621;
            margin-bottom: 10px;
            border: 2px solid #f6ad55;
            font-size: 0.95em;
        }

        .section-indicator .current {
            color: #dd6b20;
            font-size: 1.1em;
        }

        .instructions {
            background: #fffaf0;
            border-left: 5px solid #ed8936;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            color: #7c341e;
            font-size: 0.9em;
            text-align: center;
        }

        .grammar-box {
            background: #e6fffa;
            border: 2px solid #38b2ac;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 0.85em;
            color: #234e52;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
        }

        .grammar-rule {
            text-align: center;
        }

        .grammar-rule strong {
            color: #c53030;
            font-size: 1.1em;
        }

        .progress-sections {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .section-dot {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #fed7d7;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #e53e3e;
            border: 3px solid #feb2b2;
            transition: all 0.3s;
            font-size: 0.9em;
            cursor: pointer;
        }

        .section-dot.active {
            background: #fed7d7;
            border-color: #e53e3e;
            color: #c53030;
            transform: scale(1.1);
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.2);
        }

        .section-dot.completed {
            background: #c6f6d5;
            border-color: #48bb78;
            color: #22543d;
        }

        .game-board {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            min-height: 380px;
        }

        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .column {
            background: #fffaf0;
            border-radius: 15px;
            padding: 18px;
            border: 2px solid #fbd38d;
        }

        .column-title {
            text-align: center;
            font-weight: bold;
            color: #c05621;
            margin-bottom: 15px;
            font-size: 1em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .targets-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media (max-width: 480px) {
            .targets-area {
                grid-template-columns: 1fr;
            }
        }

        .target-card {
            background: white;
            border: 3px dashed #f6ad55;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            min-height: 130px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
            position: relative;
        }

        .target-card.drag-over {
            background: #fffaf0;
            border-color: #dd6b20;
            transform: scale(1.03);
        }

        .target-card.matched {
            border-color: #48bb78;
            border-style: solid;
            background: #f0fff4;
            animation: matchPulse 0.5s;
        }

        @keyframes matchPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .target-emoji {
            font-size: 2.2em;
            margin-bottom: 6px;
        }

        .target-sentence {
            font-size: 0.9em;
            color: #2d3748;
            line-height: 1.3;
        }

        .time-marker {
            color: #e53e3e;
            font-weight: bold;
            font-size: 0.85em;
            display: block;
            margin-bottom: 4px;
        }

        .blank {
            display: inline-block;
            min-width: 70px;
            border-bottom: 2px solid #e53e3e;
            color: #e53e3e;
            font-weight: bold;
        }

        .blank.filled {
            color: #48bb78;
            border-bottom-color: #48bb78;
        }

        .verbs-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .draggable-verb {
            background: white;
            border: 2px solid #e53e3e;
            border-radius: 10px;
            padding: 18px 10px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            color: #c53030;
            cursor: grab;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.2s;
            touch-action: none;
            position: relative;
            user-select: none;
        }

        .draggable-verb:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(229, 62, 62, 0.2);
        }

        .draggable-verb.dragging {
            opacity: 0.4;
            cursor: grabbing;
            transform: rotate(3deg);
        }

        .draggable-verb.matched {
            display: none;
        }

        .draggable-verb.wrong {
            animation: shake 0.5s;
            background: #fed7d7;
            border-color: #fc8181;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 15px;
            background: #fffaf0;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid #fbd38d;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #c53030;
        }

        .stat-label {
            font-size: 0.75em;
            color: #744210;
            text-transform: uppercase;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #fbd38d;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .nav-btn.prev {
            background: #fed7d7;
            color: #c53030;
        }

        .nav-btn.prev:hover:not(:disabled) {
            background: #feb2b2;
        }

        .nav-btn.next {
            background: #48bb78;
            color: white;
        }

        .nav-btn.next:hover:not(:disabled) {
            background: #38a169;
        }

        .nav-btn.next.locked {
            background: #cbd5e0;
        }

        .section-complete-btn {
            background: #ed8936 !important;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: slideIn 0.3s;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        @keyframes slideIn {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-icon {
            font-size: 3.5em;
            margin-bottom: 10px;
        }

        .modal h2 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 1.5em;
        }

        .modal p {
            color: #718096;
            margin-bottom: 15px;
            font-size: 0.95em;
        }

        .btn-modal {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95em;
            margin: 5px;
        }

        .btn-primary-modal {
            background: #e53e3e;
            color: white;
        }

        .btn-secondary-modal {
            background: #fed7d7;
            color: #c53030;
        }

        .mobile-dragging {
            position: fixed;
            pointer-events: none;
            z-index: 3000;
            opacity: 0.9;
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.4em;
            }
            
            .section-dot {
                width: 30px;
                height: 30px;
                font-size: 0.8em;
            }
            
            .draggable-verb {
                font-size: 0.95em;
                padding: 15px 8px;
            }
            
            .grammar-box {
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚è∞ Past Simple Practice</h1>
            <div class="section-indicator">
                Secci√≥n <span class="current" id="currentSectionNum">1</span> de 8
            </div>
        </header>

        <div class="instructions">
            Arrastra los verbos en pasado (regular -ed) hacia las im√°genes correctas. <br>
            <small>F√≠jate en los marcadores de tiempo: yesterday, last week, ago...</small>
        </div>

        <div class="grammar-box">
            <div class="grammar-rule">
                <strong>play ‚Üí played</strong><br>
                <small>Agrega -ed</small>
            </div>
            <div class="grammar-rule">
                <strong>love ‚Üí loved</strong><br>
                <small>Termina en e: +d</small>
            </div>
            <div class="grammar-rule">
                <strong>study ‚Üí studied</strong><br>
                <small>Consonante + y: -ied</small>
            </div>
            <div class="grammar-rule">
                <strong>stop ‚Üí stopped</strong><br>
                <small>CVC: doble consonante</small>
            </div>
        </div>

        <div class="progress-sections" id="sectionsContainer">
            <!-- Dots generados din√°micamente -->
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="totalScore">0</div>
                <div class="stat-label">Puntos</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="sectionProgress">0/4</div>
                <div class="stat-label">Secci√≥n</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalMatches">0/32</div>
                <div class="stat-label">Total</div>
            </div>
        </div>

        <div class="game-board">
            <div class="column">
                <div class="column-title">üì∑ Oraciones en Pasado</div>
                <div class="targets-area" id="targetsArea"></div>
            </div>

            <div class="column">
                <div class="column-title">üî§ Verbos (-ed)</div>
                <div class="verbs-area" id="verbsArea"></div>
            </div>
        </div>

        <div class="navigation">
            <button class="nav-btn prev" id="prevBtn" onclick="changeSection(-1)" disabled>
                ‚Üê Anterior
            </button>
            
            <button class="nav-btn next" id="nextBtn" onclick="handleNext()" disabled>
                Siguiente ‚Üí
            </button>
        </div>
    </div>

    <!-- Modal Secci√≥n Completada -->
    <div class="modal" id="sectionModal">
        <div class="modal-content">
            <div class="modal-icon">‚úÖ</div>
            <h2>¬°Secci√≥n <span id="completedSectionNum">1</span> Completada!</h2>
            <p>4 verbos regulares dominados</p>
            <p style="font-size: 1.2em; color: #e53e3e; font-weight: bold; margin: 10px 0;">
                +40 puntos
            </p>
            <button class="btn-modal btn-primary-modal" onclick="nextSection()">
                Continuar ‚Üí
            </button>
        </div>
    </div>

    <!-- Modal Juego Completado -->
    <div class="modal" id="finalModal">
        <div class="modal-content">
            <div class="modal-icon">üèÜ</div>
            <h2>¬°Juego Completado!</h2>
            <p>Has dominado los 32 verbos regulares</p>
            <div style="font-size: 1.8em; color: #e53e3e; font-weight: bold; margin: 15px 0;">
                <span id="finalScore">0</span> / 320 pts
            </div>
            <p id="finalMessage"></p>
            <button class="btn-modal btn-primary-modal" onclick="resetGame()">
                Jugar de Nuevo
            </button>
        </div>
    </div>

    <script>
        // 8 Secciones con 4 verbos regulares cada una (32 verbos totales)
        const allData = [
            // Secci√≥n 1: B√°sicos -ed
            [
                { verb: "walked", base: "walk", emoji: "üö∂", sentence: "She ___ to school yesterday." },
                { verb: "played", base: "play", emoji: "‚öΩ", sentence: "They ___ football last Sunday." },
                { verb: "watched", base: "watch", emoji: "üì∫", sentence: "He ___ TV last night." },
                { verb: "listened", base: "listen", emoji: "üéß", sentence: "I ___ to music 2 hours ago." }
            ],
            // Secci√≥n 2: Terminan en e (add -d)
            [
                { verb: "liked", base: "like", emoji: "üëç", sentence: "She ___ the movie yesterday." },
                { verb: "loved", base: "love", emoji: "‚ù§Ô∏è", sentence: "He ___ the gift last week." },
                { verb: "danced", base: "dance", emoji: "üíÉ", sentence: "They ___ all night at the party." },
                { verb: "closed", base: "close", emoji: "üö™", sentence: "She ___ the door 5 minutes ago." }
            ],
            // Secci√≥n 3: Consonante + y ‚Üí -ied
            [
                { verb: "studied", base: "study", emoji: "üìö", sentence: "He ___ for the exam yesterday." },
                { verb: "carried", base: "carry", emoji: "üíº", sentence: "She ___ the bags yesterday." },
                { verb: "cried", base: "cry", emoji: "üò¢", sentence: "The baby ___ last night." },
                { verb: "tried", base: "try", emoji: "üç∞", sentence: "He ___ the cake yesterday." }
            ],
            // Secci√≥n 4: En casa
            [
                { verb: "cleaned", base: "clean", emoji: "üßπ", sentence: "Mom ___ the house yesterday." },
                { verb: "cooked", base: "cook", emoji: "üç≥", sentence: "Dad ___ dinner last night." },
                { verb: "washed", base: "wash", emoji: "üëï", sentence: "She ___ the clothes yesterday." },
                { verb: "painted", base: "paint", emoji: "üé®", sentence: "He ___ the wall last week." }
            ],
            // Secci√≥n 5: CVC (consonante-vocal-consonante) doble
            [
                { verb: "stopped", base: "stop", emoji: "üõë", sentence: "The car ___ suddenly yesterday." },
                { verb: "planned", base: "plan", emoji: "üìÖ", sentence: "They ___ the trip last month." },
                { verb: "shopped", base: "shop", emoji: "üõçÔ∏è", sentence: "She ___ at the mall yesterday." },
                { verb: "dropped", base: "drop", emoji: "‚¨áÔ∏è", sentence: "He ___ his phone yesterday." }
            ],
            // Secci√≥n 6: Escuela/Trabajo
            [
                { verb: "worked", base: "work", emoji: "üíº", sentence: "He ___ late last Friday." },
                { verb: "finished", base: "finish", emoji: "‚úÖ", sentence: "She ___ the project yesterday." },
                { verb: "started", base: "start", emoji: "üöÄ", sentence: "They ___ the class last week." },
                { verb: "called", base: "call", emoji: "üìû", sentence: "Mom ___ me yesterday." }
            ],
            // Secci√≥n 7: Acciones f√≠sicas
            [
                { verb: "jumped", base: "jump", emoji: "ü¶ò", sentence: "He ___ very high yesterday." },
                { verb: "climbed", base: "climb", emoji: "üßó", sentence: "She ___ the mountain last month." },
                { verb: "kicked", base: "kick", emoji: "‚öΩ", sentence: "He ___ the ball yesterday." },
                { verb: "dressed", base: "dress", emoji: "üëî", sentence: "She ___ quickly this morning." }
            ],
            // Secci√≥n 8: Miscel√°neos
            [
                { verb: "rained", base: "rain", emoji: "üåßÔ∏è", sentence: "It ___ all day yesterday." },
                { verb: "snowed", base: "snow", emoji: "‚ùÑÔ∏è", sentence: "It ___ last winter." },
                { verb: "enjoyed", base: "enjoy", emoji: "üòä", sentence: "They ___ the party last night." },
                { verb: "mixed", base: "mix", emoji: "ü•£", sentence: "She ___ the ingredients yesterday." }
            ]
        ];

        let currentSection = 0;
        let totalScore = 0;
        let sectionMatches = 0;
        let totalMatches = 0;
        let draggedElement = null;
        let touchOffset = { x: 0, y: 0 };
        let matchedInSection = new Set();
        let completedSections = new Set();

        function initGame() {
            currentSection = 0;
            totalScore = 0;
            totalMatches = 0;
            completedSections.clear();
            resetSection();
            createSectionDots();
            renderSection();
            updateUI();
        }

        function createSectionDots() {
            const container = document.getElementById('sectionsContainer');
            container.innerHTML = '';
            
            for (let i = 0; i < allData.length; i++) {
                const dot = document.createElement('div');
                dot.className = 'section-dot';
                dot.textContent = i + 1;
                dot.id = `dot-${i}`;
                dot.onclick = () => jumpToSection(i);
                container.appendChild(dot);
            }
        }

        function resetSection() {
            sectionMatches = 0;
            matchedInSection.clear();
        }

        function jumpToSection(index) {
            if (index > currentSection && !completedSections.has(index - 1)) return;
            if (index === currentSection) return;
            
            currentSection = index;
            resetSection();
            renderSection();
            updateUI();
        }

        function renderSection() {
            const sectionData = allData[currentSection];
            const targetsArea = document.getElementById('targetsArea');
            const verbsArea = document.getElementById('verbsArea');
            
            targetsArea.innerHTML = '';
            verbsArea.innerHTML = '';

            // Crear targets con marcadores de tiempo
            const shuffledTargets = [...sectionData].sort(() => 0.5 - Math.random());
            const timeMarkers = ["Yesterday", "Last week", "2 days ago", "Last night", "Last Sunday", "Last month", "5 minutes ago", "This morning"];
            
            shuffledTargets.forEach((item, index) => {
                const target = document.createElement('div');
                target.className = 'target-card';
                target.dataset.verb = item.verb;
                target.dataset.index = index;
                
                target.innerHTML = `
                    <div class="target-emoji">${item.emoji}</div>
                    <div class="target-sentence">
                        <span class="time-marker">${timeMarkers[index % timeMarkers.length]}</span>
                        ${item.sentence.replace('___', '<span class="blank" id="blank-'+index+'">________</span>')}
                    </div>
                `;
                
                target.addEventListener('dragover', handleDragOver);
                target.addEventListener('dragleave', handleDragLeave);
                target.addEventListener('drop', handleDrop);
                target.addEventListener('dragenter', (e) => e.preventDefault());
                
                targetsArea.appendChild(target);
            });

            // Crear verbos arrastrables
            const shuffledVerbs = [...sectionData].sort(() => 0.5 - Math.random());
            
            shuffledVerbs.forEach(item => {
                const verbCard = document.createElement('div');
                verbCard.className = 'draggable-verb';
                verbCard.draggable = true;
                verbCard.dataset.verb = item.verb;
                verbCard.textContent = item.verb;
                
                verbCard.addEventListener('dragstart', handleDragStart);
                verbCard.addEventListener('dragend', handleDragEnd);
                verbCard.addEventListener('touchstart', handleTouchStart, {passive: false});
                verbCard.addEventListener('touchmove', handleTouchMove, {passive: false});
                verbCard.addEventListener('touchend', handleTouchEnd);
                
                verbsArea.appendChild(verbCard);
            });
        }

        // Handlers Desktop
        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', this.dataset.verb);
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            draggedElement = null;
            document.querySelectorAll('.target-card').forEach(c => c.classList.remove('drag-over'));
        }

        function handleDragOver(e) {
            e.preventDefault();
            if (!this.classList.contains('matched')) {
                this.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            if (this.classList.contains('matched')) return;
            
            const draggedVerb = e.dataTransfer.getData('text/plain');
            checkMatch(this, draggedVerb);
        }

        // Handlers Mobile
        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const card = this;
            const rect = card.getBoundingClientRect();
            
            touchOffset.x = touch.clientX - rect.left;
            touchOffset.y = touch.clientY - rect.top;
            
            const ghost = card.cloneNode(true);
            ghost.classList.add('mobile-dragging');
            ghost.style.width = rect.width + 'px';
            ghost.style.height = rect.height + 'px';
            ghost.id = 'ghost-card';
            document.body.appendChild(ghost);
            
            updateGhostPosition(touch.clientX, touch.clientY);
            card.classList.add('dragging');
            draggedElement = card;
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!draggedElement) return;
            
            const touch = e.touches[0];
            updateGhostPosition(touch.clientX, touch.clientY);
            
            const ghost = document.getElementById('ghost-card');
            ghost.style.visibility = 'hidden';
            const elemBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            ghost.style.visibility = 'visible';
            
            document.querySelectorAll('.target-card').forEach(c => c.classList.remove('drag-over'));
            
            if (elemBelow) {
                const target = elemBelow.closest('.target-card');
                if (target && !target.classList.contains('matched')) {
                    target.classList.add('drag-over');
                }
            }
        }

        function handleTouchEnd(e) {
            if (!draggedElement) return;
            
            const touch = e.changedTouches[0];
            const ghost = document.getElementById('ghost-card');
            
            ghost.style.visibility = 'hidden';
            const elemBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            ghost.style.visibility = 'visible';
            
            if (elemBelow) {
                const target = elemBelow.closest('.target-card');
                if (target && !target.classList.contains('matched')) {
                    checkMatch(target, draggedElement.dataset.verb);
                }
            }
            
            ghost.remove();
            draggedElement.classList.remove('dragging');
            draggedElement = null;
            document.querySelectorAll('.target-card').forEach(c => c.classList.remove('drag-over'));
        }

        function updateGhostPosition(x, y) {
            const ghost = document.getElementById('ghost-card');
            if (ghost) {
                ghost.style.left = (x - touchOffset.x) + 'px';
                ghost.style.top = (y - touchOffset.y) + 'px';
            }
        }

        function checkMatch(targetCard, draggedVerb) {
            const targetVerb = targetCard.dataset.verb;
            
            if (draggedVerb === targetVerb && !matchedInSection.has(targetVerb)) {
                matchedInSection.add(targetVerb);
                sectionMatches++;
                totalMatches++;
                totalScore += 10;
                
                targetCard.classList.add('matched');
                const blank = targetCard.querySelector('.blank');
                if (blank) {
                    blank.textContent = draggedVerb;
                    blank.classList.add('filled');
                }
                
                const draggable = document.querySelector(`.draggable-verb[data-verb="${draggedVerb}"]`);
                if (draggable) draggable.classList.add('matched');
                
                updateUI();
                
                if (sectionMatches === 4) {
                    completedSections.add(currentSection);
                    setTimeout(() => {
                        if (currentSection < allData.length - 1) {
                            showSectionComplete();
                        } else {
                            showGameComplete();
                        }
                    }, 600);
                }
            } else if (draggedVerb !== targetVerb) {
                const draggable = document.querySelector(`.draggable-verb[data-verb="${draggedVerb}"]`);
                if (draggable) {
                    draggable.classList.add('wrong');
                    setTimeout(() => draggable.classList.remove('wrong'), 500);
                }
                targetCard.style.animation = 'shake 0.5s';
                setTimeout(() => targetCard.style.animation = '', 500);
            }
        }

        function updateUI() {
            document.getElementById('currentSectionNum').textContent = currentSection + 1;
            document.getElementById('totalScore').textContent = totalScore;
            document.getElementById('sectionProgress').textContent = `${sectionMatches}/4`;
            document.getElementById('totalMatches').textContent = `${totalMatches}/${allData.length * 4}`;
            
            for (let i = 0; i < allData.length; i++) {
                const dot = document.getElementById(`dot-${i}`);
                dot.className = 'section-dot';
                if (i === currentSection) dot.classList.add('active');
                else if (completedSections.has(i)) dot.classList.add('completed');
            }
            
            document.getElementById('prevBtn').disabled = currentSection === 0;
            
            const nextBtn = document.getElementById('nextBtn');
            const isLastSection = currentSection === allData.length - 1;
            
            if (sectionMatches === 4) {
                nextBtn.disabled = false;
                nextBtn.textContent = isLastSection ? 'Ver Resultados üèÜ' : 'Siguiente ‚Üí';
                nextBtn.classList.add('section-complete-btn');
            } else {
                nextBtn.disabled = true;
                nextBtn.textContent = 'Bloqueado üîí';
                nextBtn.classList.remove('section-complete-btn');
            }
        }

        function handleNext() {
            if (sectionMatches < 4) return;
            
            if (currentSection === allData.length - 1) {
                showGameComplete();
            } else {
                changeSection(1);
            }
        }

        function changeSection(direction) {
            currentSection += direction;
            resetSection();
            renderSection();
            updateUI();
        }

        function showSectionComplete() {
            document.getElementById('completedSectionNum').textContent = currentSection + 1;
            document.getElementById('sectionModal').classList.add('show');
        }

        function nextSection() {
            document.getElementById('sectionModal').classList.remove('show');
            changeSection(1);
        }

        function showGameComplete() {
            const maxScore = allData.length * 40;
            const percentage = Math.round((totalScore / maxScore) * 100);
            let message = '';
            
            if (percentage === 100) message = '¬°Dominas el Past Simple! üåüüåüüåü';
            else if (percentage >= 90) message = '¬°Excelente manejo del pasado! üéâ';
            else if (percentage >= 75) message = '¬°Muy buen trabajo! üëè';
            else if (percentage >= 50) message = 'Sigue practicando las reglas -ed üí™';
            else message = 'Repasa la formaci√≥n del pasado simple üìö';
            
            document.getElementById('finalScore').textContent = totalScore;
            document.getElementById('finalMessage').textContent = message;
            document.getElementById('finalModal').classList.add('show');
        }

        function resetGame() {
            document.getElementById('finalModal').classList.remove('show');
            document.getElementById('sectionModal').classList.remove('show');
            initGame();
        }

        document.addEventListener('touchmove', function(e) {
            if (e.target.closest('.draggable-verb')) {
                e.preventDefault();
            }
        }, { passive: false });

        window.onload = initGame;
    </script>
</body>
</html>